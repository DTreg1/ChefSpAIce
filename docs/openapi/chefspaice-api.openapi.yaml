openapi: 3.0.3
info:
  title: ChefSpAIce API
  description: |
    ChefSpAIce kitchen inventory management API.
    AI-powered recipe generation, meal planning, inventory tracking, and grocery shopping integration.

    ## Authentication
    Most endpoints require a Bearer token obtained from `/api/auth/login`,
    `/api/auth/register`, or social login endpoints via the `BearerAuth` security
    scheme. Protected endpoints additionally require an active subscription
    (free trial or paid).

    Endpoints marked with `security: []` are intentionally unauthenticated. These
    fall into four categories:

    - **Auth flow**: Login, registration, password reset, and social sign-in
      endpoints must be accessible without a token.
    - **Public reference data**: Cooking terms, appliance catalogs, subscription
      pricing, and health checks serve publicly cacheable data.
    - **Instacart proxy**: Shopping link and retailer endpoints forward requests
      to the Instacart Connect API using a server-side API key. They are
      unauthenticated to support deep-link and share flows. Rate limiting
      (see above) mitigates abuse.
    - **Error reporting**: Crash reports are accepted without auth so that
      logged-out or token-expired clients can still report failures.

    ## Response Format
    All successful responses follow this wrapper:
    ```json
    { "success": true, "data": { ... }, "message": "optional message" }
    ```
    All error responses follow this wrapper:
    ```json
    { "success": false, "error": "Human-readable message", "errorCode": "MACHINE_CODE", "details": { ... } }
    ```

    ## ID Types
    All resource IDs are strings (typically UUIDs or client-generated identifiers).
    For backwards compatibility, the server currently accepts integer IDs and coerces them to strings internally.
    **Deprecation notice:** Integer ID support is deprecated as of v1.0.0 and will be removed in v2.0.0 (targeted Q3 2026). Clients should migrate to string IDs exclusively.

    ## Rate Limiting
    Rate-limited endpoints return standard headers on every response (including successful ones):

    | Header | Description |
    |--------|-------------|
    | `X-RateLimit-Limit` | Maximum requests allowed in the current window |
    | `X-RateLimit-Remaining` | Requests remaining in the current window |
    | `X-RateLimit-Reset` | UTC epoch seconds when the current window resets |

    When the limit is exceeded, the API returns `429 Too Many Requests` with a `Retry-After` header (seconds until the next window).

    ### Tiers
    | Tier | Window | Limit | Applies to |
    |------|--------|-------|------------|
    | **AI** | 1 min | 10 | Recipe generation, image analysis, chat, voice, scanning |
    | **Write** | 1 min | 60 | Sync mutations, uploads, checkout, imports |
    | **Auth** | 15 min | 20 | Login, registration, social auth |

    ## Naming Conventions
    This API uses **camelCase** for all property names by default.
    Two groups of endpoints deviate from this convention because they pass through request/response bodies to external APIs whose contracts require `snake_case`:

    | Tag | External API | Reason |
    |-----|-------------|--------|
    | **Instacart** | [Instacart Connect](https://docs.instacart.com/) | Line-item schemas and request fields (`retailer_key`, `enable_pantry_items`, `cooking_time`, etc.) mirror Instacart's API contract. Renaming would break product-matching and delivery integration. |
    | **RevenueCat Webhooks** | [RevenueCat](https://www.revenuecat.com/docs/api/) | Webhook payloads (`app_user_id`, `product_id`, `purchased_at_ms`, etc.) are defined by RevenueCat and must match their schema for signature verification. |

    SDK generators should treat these schemas as opaque pass-through types. A future major version may introduce normalized camelCase adapter schemas with automatic mapping.

    ## Status Codes
    Resource creation endpoints return `201 Created` when a new server-side resource
    is persisted (e.g. user registration, appliance addition, error reports).
    Multi-purpose endpoints that may create, update, or delete resources (such as
    sync operations) return `200 OK` regardless of the operation performed.
    Endpoints that return external URLs or session tokens (e.g. Stripe checkout,
    Instacart links) also return `200 OK` since no local resource is created.
  version: 1.0.0
  contact:
    name: ChefSpAIce Support
    url: https://chefspaice.com/support
servers:
  - url: "{protocol}://{host}"
    description: ChefSpAIce API Server
    variables:
      protocol:
        default: https
        enum:
          - http
          - https
      host:
        default: chefspaice.com
tags:
  - name: Health
    description: Health check endpoints
  - name: Auth
    description: Email-based authentication (login, register, logout, password reset). Session tokens are valid for 30 days from issuance and do not auto-refresh. Clients should call `POST /api/auth/restore-session` on launch to validate and extend the session. Expired sessions return 401 with error code `SESSION_EXPIRED`.
  - name: Account
    description: Account settings, sync, and deletion
  - name: Sync
    description: Cross-section sync operations (status, full export, full import). **Design notes:** (1) PUT (update) and POST (create) are kept separate rather than merged into a single upsert to preserve explicit conflict detection via `serverVersion` optimistic locking. (2) DELETE endpoints accept a request body with `ids[]` for batch deletion; clients that strip DELETE bodies should use individual DELETE calls instead.
  - name: Sync - Inventory
    description: Inventory item sync (CRUD + paginated reads)
  - name: Sync - Recipes
    description: Saved recipe sync (CRUD + paginated reads)
  - name: Sync - Shopping List
    description: Shopping list sync (CRUD + paginated reads)
  - name: Sync - Meal Plans
    description: Meal plan sync (CRUD + paginated reads)
  - name: Sync - Cookware
    description: Cookware item sync (CRUD + paginated reads)
  - name: Recipes
    description: Recipe generation and management
  - name: Suggestions
    description: AI-powered recipe suggestions
  - name: Ingredients
    description: Ingredient parsing and management
  - name: Nutrition
    description: Nutrition data lookup (USDA FoodData Central)
  - name: Cooking Terms
    description: Cooking terminology definitions
  - name: Appliances
    description: Read-only kitchen appliance catalog (common and full list)
  - name: User Appliances
    description: Per-user appliance equipment (CRUD and bulk operations)
  - name: Chat
    description: AI kitchen assistant with function calling
  - name: Shelf Life
    description: AI-powered shelf life estimation
  - name: Voice
    description: Voice command processing (transcribe, speak, parse, chat)
  - name: Image Analysis
    description: AI food image recognition
  - name: Receipt Analysis
    description: AI receipt scanning and item extraction
  - name: Recipe Images
    description: Recipe image upload and management
  - name: Instacart
    description: Instacart Connect grocery shopping integration. **Naming convention:** Properties in Instacart schemas use `snake_case` (e.g. `retailer_key`, `enable_pantry_items`, `cooking_time`, `image_url`) to match the Instacart Connect API contract. All other ChefSpAIce endpoints use camelCase.
  - name: Subscriptions
    description: Stripe subscription management
  - name: Feedback
    description: User feedback and feature requests
  - name: Donations
    description: Support donations via Stripe
  - name: Referrals
    description: Referral system
  - name: Version Check
    description: App version checking for OTA update decisions
  - name: Analytics
    description: Food waste analytics and consumption tracking
  - name: Notifications
    description: Push notification management and device registration
  - name: Error Reports
    description: Client-side crash reporting
  - name: External API
    description: External API for Siri Shortcuts integration
  - name: Logo
    description: Logo and branding asset export
  - name: Pages
    description: Server-rendered HTML pages (marketing, legal, support). These are not programmatic API endpoints and are excluded from SDK generation. Included here for completeness and link documentation.
  - name: Pre-Registration
    description: Landing page email signup
  - name: Admin - Analytics
    description: Admin analytics dashboard
  - name: Admin - Subscriptions
    description: Admin subscription management
  - name: Admin - Data Export
    description: Admin full data export
  - name: Stripe Webhooks
    description: Stripe subscription lifecycle webhooks. The endpoint receives raw JSON payloads with HMAC signature verification via the `Stripe-Signature` header. Registered before Express body parsing to preserve the raw payload for signature validation.
  - name: RevenueCat Webhooks
    description: RevenueCat iOS/Android purchase webhooks. **Naming convention:** Webhook payload properties use `snake_case` (e.g. `app_user_id`, `product_id`, `purchased_at_ms`) to match the RevenueCat webhook schema. All other ChefSpAIce endpoints use camelCase.
security:
  - BearerAuth: []
components:
  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: Session Token
      description: Session token from login/register/social auth endpoints
    AdminAuth:
      type: http
      scheme: bearer
      bearerFormat: Session Token
      description: Same session token as BearerAuth, but the authenticated user must have the isAdmin flag set. The server returns 401 if the token is missing or expired, and 403 if the user is not an admin.
    RevenueCatWebhookAuth:
      type: http
      scheme: bearer
      description: RevenueCat sends an Authorization header with a shared webhook secret. The server validates the Bearer token against the REVENUECAT_WEBHOOK_SECRET environment variable. If the secret is not configured, all requests are accepted (development mode).
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: Session token obtained from /api/auth/login.
  headers:
    X-RateLimit-Limit:
      description: Maximum number of requests allowed in the current time window
      schema:
        type: integer
        example: 60
    X-RateLimit-Remaining:
      description: Number of requests remaining in the current time window
      schema:
        type: integer
        example: 42
    X-RateLimit-Reset:
      description: UTC epoch seconds when the current rate limit window resets
      schema:
        type: integer
        example: 1717027200
    Retry-After:
      description: Seconds until the rate limit window resets (only on 429 responses)
      schema:
        type: integer
        example: 30
  responses:
    TooManyRequests:
      description: Rate limit exceeded. Retry after the number of seconds indicated by the Retry-After header.
      headers:
        X-RateLimit-Limit:
          $ref: "#/components/headers/X-RateLimit-Limit"
        X-RateLimit-Remaining:
          $ref: "#/components/headers/X-RateLimit-Remaining"
        X-RateLimit-Reset:
          $ref: "#/components/headers/X-RateLimit-Reset"
        Retry-After:
          $ref: "#/components/headers/Retry-After"
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/ErrorResponse"
  schemas:
    Appliance:
      type: object
      properties:
        id:
          type: integer
        name:
          type: string
        category:
          type: string
        description:
          type: string
        icon:
          type: string
        isCommon:
          type: boolean
        alternatives:
          type: array
          items:
            type: string
        imageUrl:
          type: string
    CheckoutSessionResult:
      type: object
      description: Stripe Checkout session details for client-side redirect.
      required:
        - sessionId
        - url
      properties:
        sessionId:
          type: string
        url:
          type: string
          format: uri
    CookingTerm:
      type: object
      properties:
        id:
          type: string
        term:
          type: string
        definition:
          type: string
        shortDefinition:
          type: string
        longDefinition:
          type: string
        category:
          type: string
        difficulty:
          type: string
          enum:
            - beginner
            - intermediate
            - advanced
        timeEstimate:
          type: string
        tools:
          type: array
          items:
            type: string
        tips:
          type: array
          items:
            type: string
        videoUrl:
          type: string
        imageUrl:
          type: string
        relatedTerms:
          type: array
          items:
            type: string
        example:
          type: string
    CookwareExport:
      type: object
      properties:
        id:
          type: string
        name:
          type: string
          nullable: true
        category:
          type: string
          nullable: true
        alternatives:
          type: array
          nullable: true
          items:
            type: string
        updatedAt:
          type: string
          format: date-time
        extraData:
          type: object
          nullable: true
          description: Additional client-defined fields preserved during sync.
      additionalProperties: false
    CookwareItem:
      type: object
      properties:
        id:
          type: string
        name:
          type: string
          nullable: true
        category:
          type: string
          nullable: true
        alternatives:
          type: array
          items:
            type: string
          nullable: true
      required:
        - id
    EntitlementsResponse:
      type: object
      description: Full subscription entitlements, usage counters, limits, and billing state.
      required:
        - tier
        - status
        - cancelAtPeriodEnd
      properties:
        tier:
          type: string
          description: Current subscription tier
        status:
          type: string
          description: Subscription status (active, trialing, past_due, canceled, paused)
        planType:
          type: string
          nullable: true
          description: Billing interval (monthly, annual) or null if free
        entitlements:
          type: object
          description: Feature-level limits for the current tier
          properties:
            maxPantryItems:
              type: integer
              description: -1 means unlimited
            maxAiRecipesPerMonth:
              type: integer
              description: -1 means unlimited
            maxCookwareItems:
              type: integer
              description: -1 means unlimited
            canCustomizeStorageAreas:
              type: boolean
            canUseRecipeScanning:
              type: boolean
            canUseBulkScanning:
              type: boolean
            canUseAiKitchenAssistant:
              type: boolean
            canUseWeeklyMealPrepping:
              type: boolean
        usage:
          type: object
          description: Current usage counters for the billing period
          properties:
            pantryItemCount:
              type: integer
            aiRecipesUsedThisMonth:
              type: integer
            cookwareCount:
              type: integer
        remaining:
          type: object
          description: Remaining quota for each limited resource
          properties:
            pantryItems:
              oneOf:
                - type: integer
                - type: string
                  enum:
                    - unlimited
            aiRecipes:
              oneOf:
                - type: integer
                - type: string
                  enum:
                    - unlimited
            cookware:
              oneOf:
                - type: integer
                - type: string
                  enum:
                    - unlimited
        trialEndsAt:
          type: string
          format: date-time
          nullable: true
        currentPeriodEnd:
          type: string
          format: date-time
          nullable: true
        cancelAtPeriodEnd:
          type: boolean
        paymentFailedAt:
          type: string
          format: date-time
          nullable: true
        gracePeriodEnd:
          type: string
          format: date-time
          nullable: true
        graceDaysRemaining:
          type: integer
          nullable: true
    ErrorEnvelope:
      type: object
      properties:
        success:
          type: boolean
          example: false
        error:
          type: string
        errorCode:
          type: string
    ErrorResponse:
      type: object
      properties:
        success:
          type: boolean
          enum:
            - false
        error:
          type: string
          description: Human-readable error message
        errorCode:
          type: string
          description: Machine-readable error code
        details:
          type: object
          description: Additional error context
      required:
        - success
        - error
        - errorCode
    FeatureCheckResponse:
      description: Response for subscription feature access checks
      type: object
      properties:
        success:
          type: boolean
        data:
          type: object
          properties:
            allowed:
              type: boolean
            upgradeRequired:
              type: boolean
    FoodAnalysisItem:
      type: object
      properties:
        name:
          type: string
          example: Gala Apple
        category:
          type: string
          enum:
            - produce
            - dairy
            - meat
            - seafood
            - bread
            - canned
            - frozen
            - beverages
            - condiments
            - snacks
            - grains
            - spices
            - other
        quantity:
          type: number
          example: 3
        quantityUnit:
          type: string
          enum:
            - items
            - lbs
            - oz
            - bunch
            - container
            - bag
            - box
            - bottle
            - can
        storageLocation:
          type: string
          enum:
            - refrigerator
            - freezer
            - pantry
            - counter
        shelfLifeDays:
          type: integer
          minimum: 1
          maximum: 365
          example: 7
        confidence:
          type: number
          format: float
          minimum: 0
          maximum: 1
          example: 0.85
    GeneratedRecipe:
      type: object
      description: AI-generated recipe with inventory awareness and equipment suggestions.
      required:
        - title
        - ingredients
        - instructions
      properties:
        title:
          type: string
        description:
          type: string
        ingredients:
          type: array
          items:
            $ref: "#/components/schemas/RecipeIngredient"
        instructions:
          type: array
          items:
            type: string
        prepTime:
          type: integer
        cookTime:
          type: integer
        servings:
          type: integer
        nutrition:
          allOf:
            - $ref: "#/components/schemas/NutritionInfo"
          nullable: true
        usedExpiringItems:
          type: array
          items:
            type: string
          description: Names of soon-to-expire inventory items used in this recipe
        usedExpiringCount:
          type: integer
        requiredEquipment:
          type: array
          items:
            type: string
        optionalEquipment:
          type: array
          items:
            type: string
        substitutionNotes:
          type: array
          items:
            type: string
        totalExpiringItems:
          type: integer
        prioritizedExpiring:
          type: boolean
        subscription:
          type: object
          properties:
            aiRecipesRemaining:
              type: integer
              nullable: true
            aiRecipesLimit:
              type: integer
              nullable: true
    InstacartLineItem:
      description: Product line item returned by the Instacart Connect API. Property names use snake_case to match the Instacart API contract.
      allOf:
        - $ref: "#/components/schemas/InstacartLineItemBase"
        - type: object
          required:
            - quantity
            - unit
            - display_text
          properties:
            quantity:
              type: number
              default: 1
    InstacartLineItemBase:
      description: Common properties shared between Instacart line item input and output. Property names use snake_case to match the Instacart API contract.
      type: object
      required:
        - name
      properties:
        name:
          type: string
        quantity:
          type: number
        unit:
          type: string
        display_text:
          type: string
        upcs:
          type: array
          items:
            type: string
        product_ids:
          type: array
          items:
            type: string
        brand_filters:
          type: array
          items:
            type: string
        health_filters:
          type: array
          items:
            type: string
        line_item_measurements:
          type: object
          properties:
            size:
              type: number
            unit:
              type: string
        image_url:
          type: string
        instructions:
          type: string
        enable_pantry_items:
          type: boolean
    InstacartLineItemInput:
      description: Product line item sent to the Instacart Connect API. Property names use snake_case to match the Instacart API contract.
      allOf:
        - $ref: "#/components/schemas/InstacartLineItemBase"
        - type: object
          properties:
            upc:
              type: string
            brand:
              type: string
            image_url:
              type: string
              format: uri
    InventoryItem:
      type: object
      properties:
        id:
          type: string
        name:
          type: string
        barcode:
          type: string
          nullable: true
        quantity:
          type: number
          default: 1
        unit:
          type: string
          default: unit
        storageLocation:
          type: string
          default: pantry
        purchaseDate:
          type: string
          nullable: true
        expirationDate:
          type: string
          nullable: true
        category:
          type: string
          default: other
        usdaCategory:
          type: string
          nullable: true
        nutrition:
          type: object
          nullable: true
        notes:
          type: string
          nullable: true
        imageUri:
          type: string
          nullable: true
        fdcId:
          type: integer
          nullable: true
      required:
        - id
        - name
    InventoryItemExport:
      type: object
      properties:
        id:
          type: string
        name:
          type: string
        barcode:
          type: string
          nullable: true
        quantity:
          type: number
        unit:
          type: string
        storageLocation:
          type: string
        purchaseDate:
          type: string
          nullable: true
        expirationDate:
          type: string
          nullable: true
        category:
          type: string
        usdaCategory:
          type: string
          nullable: true
        nutrition:
          allOf:
            - $ref: "#/components/schemas/NutritionInfo"
          nullable: true
        notes:
          type: string
          nullable: true
        imageUri:
          type: string
          nullable: true
        fdcId:
          type: integer
          nullable: true
        updatedAt:
          type: string
          format: date-time
    LimitCheckResponse:
      description: Response for subscription usage limit checks
      type: object
      properties:
        success:
          type: boolean
        data:
          type: object
          properties:
            limit:
              type: integer
            used:
              type: integer
            remaining:
              type: integer
    MealPlanExport:
      type: object
      properties:
        id:
          type: string
        date:
          type: string
        meals:
          type: array
          nullable: true
          items:
            $ref: "#/components/schemas/MealSlot"
        updatedAt:
          type: string
          format: date-time
        extraData:
          type: object
          nullable: true
          description: Additional client-defined fields preserved during sync.
      additionalProperties: false
    MealPlanItem:
      type: object
      required:
        - id
        - date
      properties:
        id:
          type: string
        date:
          type: string
        meals:
          type: array
          nullable: true
          items:
            $ref: "#/components/schemas/MealSlot"
    MealSlot:
      type: object
      description: A single meal entry within a meal plan day.
      required:
        - type
      properties:
        type:
          type: string
          description: Meal slot type (e.g., breakfast, lunch, dinner, snack)
        recipeId:
          type: string
          nullable: true
          description: Reference to a saved recipe
        customMeal:
          type: string
          nullable: true
          description: Free-text meal name when not linked to a recipe
    Notification:
      type: object
      required:
        - id
        - userId
        - type
        - title
        - body
        - isRead
        - createdAt
      properties:
        id:
          type: integer
        userId:
          type: string
        type:
          type: string
          description: Notification category
          enum:
            - security
            - payment_failed
            - winback
            - subscription
            - general
        title:
          type: string
        body:
          type: string
        isRead:
          type: boolean
        data:
          type: object
          nullable: true
          description: "Type-specific payload. Shape varies by notification type: security → { sessionId }, payment_failed → { stripeCustomerId, invoiceId }, winback → null, subscription → { planId }."
        deepLink:
          type: string
          nullable: true
          description: Deep link URI for navigation when notification is tapped
        createdAt:
          type: string
          format: date-time
    NutritionInfo:
      type: object
      description: Nutritional data for a food item or recipe.
      properties:
        calories:
          type: number
        protein:
          type: number
        carbs:
          type: number
        fat:
          type: number
        fiber:
          type: number
        sugar:
          type: number
        sodium:
          type: number
    PaginationParams:
      type: object
      properties:
        limit:
          type: integer
          default: 50
          maximum: 100
        cursor:
          type: string
          description: Base64url-encoded JSON cursor of (updatedAt, id)
    PriceInfo:
      type: object
      required:
        - id
        - amount
        - currency
        - interval
        - intervalCount
        - trialDays
        - productName
      properties:
        id:
          type: string
        amount:
          type: integer
        currency:
          type: string
        interval:
          type: string
          enum:
            - month
            - year
        intervalCount:
          type: integer
        trialDays:
          type: integer
        productName:
          type: string
    ReceiptItem:
      type: object
      properties:
        name:
          type: string
          example: Organic Bananas
        category:
          type: string
          enum:
            - produce
            - dairy
            - meat
            - seafood
            - bread
            - canned
            - frozen
            - beverages
            - condiments
            - snacks
            - grains
            - spices
            - other
        quantity:
          type: number
          example: 3
        quantityUnit:
          type: string
          enum:
            - items
            - lbs
            - oz
            - kg
            - g
            - bunch
            - container
            - bag
            - box
            - bottle
            - can
            - pack
        storageLocation:
          type: string
          enum:
            - refrigerator
            - freezer
            - pantry
            - counter
        shelfLifeDays:
          type: integer
          minimum: 1
          maximum: 365
        confidence:
          type: number
          format: float
          minimum: 0
          maximum: 1
        price:
          type: number
          description: Item price (if visible on receipt).
          example: 4.99
        upc:
          type: string
          description: UPC/barcode if visible (12-13 digits).
          example: "012345678901"
        originalText:
          type: string
          description: Raw text from the receipt for this line item.
          example: ORG BAN 3LB @1.99/LB
        nutrition:
          type: object
          description: USDA nutrition data (populated when UPC lookup succeeds).
    RecipeExport:
      type: object
      properties:
        id:
          type: string
        title:
          type: string
        description:
          type: string
          nullable: true
        ingredients:
          type: array
          items:
            $ref: "#/components/schemas/RecipeIngredient"
        instructions:
          type: array
          items:
            type: string
        prepTime:
          type: integer
          nullable: true
        cookTime:
          type: integer
          nullable: true
        servings:
          type: integer
          nullable: true
        imageUri:
          type: string
          nullable: true
        cloudImageUri:
          type: string
          nullable: true
        nutrition:
          allOf:
            - $ref: "#/components/schemas/NutritionInfo"
          nullable: true
        isFavorite:
          type: boolean
        updatedAt:
          type: string
          format: date-time
        extraData:
          type: object
          nullable: true
          description: Additional client-defined fields preserved during sync.
      additionalProperties: false
    RecipeIngredient:
      type: object
      description: A single ingredient entry in a recipe.
      required:
        - name
      properties:
        name:
          type: string
        quantity:
          oneOf:
            - type: number
            - type: string
        unit:
          type: string
        fromInventory:
          type: boolean
    RecipeItem:
      type: object
      properties:
        id:
          type: string
        title:
          type: string
        description:
          type: string
          nullable: true
        ingredients:
          type: array
          items:
            type: object
          nullable: true
        instructions:
          type: array
          items:
            type: string
          nullable: true
        prepTime:
          type: integer
          nullable: true
        cookTime:
          type: integer
          nullable: true
        servings:
          type: integer
          nullable: true
        imageUri:
          type: string
          nullable: true
        cloudImageUri:
          type: string
          nullable: true
        nutrition:
          type: object
          nullable: true
        isFavorite:
          type: boolean
          default: false
      required:
        - id
        - title
    ShelfLifeResult:
      type: object
      properties:
        suggestedDays:
          type: integer
          description: Estimated shelf life in days.
          example: 7
        confidence:
          type: string
          enum:
            - high
            - medium
            - low
          example: medium
        source:
          type: string
          enum:
            - local
            - ai
          description: Whether the estimate came from the local database or AI.
          example: ai
        notes:
          type: string
          description: Brief storage tip.
          example: Store in the crisper drawer for best freshness.
        signsOfSpoilage:
          type: string
          description: What to look for when the food goes bad.
          example: Mold, slimy texture, off smell.
    ShoppingItem:
      type: object
      properties:
        id:
          type: string
        name:
          type: string
        quantity:
          type: number
          default: 1
        unit:
          type: string
          default: unit
        isChecked:
          type: boolean
          default: false
        category:
          type: string
          nullable: true
        recipeId:
          type: string
          nullable: true
      required:
        - id
        - name
    ShoppingItemExport:
      type: object
      properties:
        id:
          type: string
        name:
          type: string
        quantity:
          type: number
        unit:
          type: string
        isChecked:
          type: boolean
        category:
          type: string
          nullable: true
        recipeId:
          type: string
          nullable: true
        updatedAt:
          type: string
          format: date-time
        extraData:
          type: object
          nullable: true
          description: Additional client-defined fields preserved during sync.
      additionalProperties: false
    SubscriptionWithUser:
      type: object
      properties:
        id:
          type: string
        userId:
          type: string
        stripeCustomerId:
          type: string
          nullable: true
        stripeSubscriptionId:
          type: string
          nullable: true
        stripePriceId:
          type: string
          nullable: true
        status:
          type: string
        planType:
          type: string
        currentPeriodStart:
          type: string
          format: date-time
        currentPeriodEnd:
          type: string
          format: date-time
        trialStart:
          type: string
          format: date-time
          nullable: true
        trialEnd:
          type: string
          format: date-time
          nullable: true
        cancelAtPeriodEnd:
          type: boolean
        canceledAt:
          type: string
          format: date-time
          nullable: true
        createdAt:
          type: string
          format: date-time
          nullable: true
        updatedAt:
          type: string
          format: date-time
          nullable: true
        user:
          type: object
          properties:
            id:
              type: string
            email:
              type: string
            displayName:
              type: string
              nullable: true
            createdAt:
              type: string
              format: date-time
              nullable: true
    SuccessEnvelope:
      type: object
      properties:
        success:
          type: boolean
          example: true
        data:
          type: object
        message:
          type: string
    SuccessResponse:
      type: object
      description: Generic success response envelope. Most endpoints define typed inline responses instead.
      properties:
        success:
          type: boolean
          enum:
            - true
        data:
          description: Response payload (varies by endpoint)
        message:
          type: string
      required:
        - success
    SyncCookwareInput:
      type: object
      required:
        - id
      properties:
        id:
          type: string
          description: Resource ID. Integer IDs are deprecated (coerced to string); use string IDs exclusively.
        name:
          type: string
        category:
          type: string
        alternatives:
          type: array
          items:
            type: string
        updatedAt:
          type: string
          format: date-time
        extraData:
          type: object
          nullable: true
          description: Additional client-defined fields preserved during sync.
      additionalProperties: false
    SyncCookwareItem:
      type: object
      required:
        - id
      properties:
        id:
          type: string
        name:
          type: string
          nullable: true
        category:
          type: string
          nullable: true
        alternatives:
          type: array
          nullable: true
          items:
            type: string
        updatedAt:
          type: string
          format: date-time
    SyncDeleteResponse:
      description: Standard response for sync DELETE operations
      type: object
      properties:
        success:
          type: boolean
          enum:
            - true
        data:
          type: object
          properties:
            syncedAt:
              type: string
              format: date-time
            operation:
              type: string
              enum:
                - delete
            itemId:
              type: string
    SyncInventoryItem:
      type: object
      required:
        - id
        - name
      properties:
        id:
          type: string
        name:
          type: string
        barcode:
          type: string
          nullable: true
        quantity:
          type: number
        unit:
          type: string
        storageLocation:
          type: string
        purchaseDate:
          type: string
          nullable: true
        expirationDate:
          type: string
          nullable: true
        category:
          type: string
        usdaCategory:
          type: string
          nullable: true
        nutrition:
          allOf:
            - $ref: "#/components/schemas/NutritionInfo"
          nullable: true
        notes:
          type: string
          nullable: true
        imageUri:
          type: string
          nullable: true
        fdcId:
          type: integer
          nullable: true
        updatedAt:
          type: string
          format: date-time
        deletedAt:
          type: string
          format: date-time
          nullable: true
    SyncInventoryItemInput:
      type: object
      required:
        - id
        - name
      properties:
        id:
          type: string
          description: Resource ID. Integer IDs are deprecated (coerced to string); use string IDs exclusively.
        name:
          type: string
        barcode:
          type: string
        quantity:
          type: number
        unit:
          type: string
        storageLocation:
          type: string
        purchaseDate:
          type: string
        expirationDate:
          type: string
        category:
          type: string
        usdaCategory:
          type: string
        nutrition:
          type: object
          nullable: true
          properties:
            calories:
              type: number
            protein:
              type: number
            carbs:
              type: number
            fat:
              type: number
            fiber:
              type: number
            sugar:
              type: number
            sodium:
              type: number
        notes:
          type: string
        imageUri:
          type: string
        fdcId:
          type: integer
        updatedAt:
          type: string
          format: date-time
        deletedAt:
          type: string
          format: date-time
          nullable: true
    SyncMealPlan:
      type: object
      required:
        - id
        - date
      properties:
        id:
          type: string
        date:
          type: string
        meals:
          type: array
          nullable: true
          items:
            $ref: "#/components/schemas/MealSlot"
        updatedAt:
          type: string
          format: date-time
    SyncMealPlanInput:
      type: object
      required:
        - id
        - date
      properties:
        id:
          type: string
          description: Resource ID. Integer IDs are deprecated (coerced to string); use string IDs exclusively.
        date:
          type: string
        meals:
          type: array
          nullable: true
          items:
            $ref: "#/components/schemas/MealSlot"
        updatedAt:
          type: string
          format: date-time
        extraData:
          type: object
          nullable: true
          description: Additional client-defined fields preserved during sync.
      additionalProperties: false
    SyncOperationResponse:
      description: Standard response for sync POST operations (create/update/delete with conflict resolution)
      type: object
      properties:
        success:
          type: boolean
          enum:
            - true
        data:
          type: object
          properties:
            syncedAt:
              type: string
              format: date-time
            operation:
              type: string
              enum:
                - create
                - update
                - delete
                - skipped
            itemId:
              type: string
            reason:
              type: string
              description: Present when operation is "skipped" due to stale client timestamp
    SyncRecipe:
      type: object
      required:
        - id
        - title
        - ingredients
        - instructions
      properties:
        id:
          type: string
        title:
          type: string
        description:
          type: string
          nullable: true
        ingredients:
          type: array
          items:
            $ref: "#/components/schemas/RecipeIngredient"
        instructions:
          type: array
          items:
            type: string
        prepTime:
          type: integer
          nullable: true
        cookTime:
          type: integer
          nullable: true
        servings:
          type: integer
          nullable: true
        imageUri:
          type: string
          nullable: true
        cloudImageUri:
          type: string
          nullable: true
        nutrition:
          allOf:
            - $ref: "#/components/schemas/NutritionInfo"
          nullable: true
        isFavorite:
          type: boolean
        updatedAt:
          type: string
          format: date-time
    SyncRecipeInput:
      type: object
      required:
        - id
        - title
      properties:
        id:
          type: string
          description: Resource ID. Integer IDs are deprecated (coerced to string); use string IDs exclusively.
        title:
          type: string
        description:
          type: string
        ingredients:
          type: array
          items:
            type: object
            properties:
              name:
                type: string
              quantity:
                oneOf:
                  - type: number
                  - type: string
              unit:
                type: string
        instructions:
          type: array
          items:
            type: string
        prepTime:
          type: integer
        cookTime:
          type: integer
        servings:
          type: integer
        imageUri:
          type: string
        cloudImageUri:
          type: string
        nutrition:
          type: object
          nullable: true
          properties:
            calories:
              type: number
            protein:
              type: number
            carbs:
              type: number
            fat:
              type: number
        isFavorite:
          type: boolean
        updatedAt:
          type: string
          format: date-time
        extraData:
          type: object
          nullable: true
          description: Additional client-defined fields preserved during sync.
      additionalProperties: false
    SyncShoppingItem:
      type: object
      required:
        - id
        - name
      properties:
        id:
          type: string
        name:
          type: string
        quantity:
          type: number
        unit:
          type: string
        isChecked:
          type: boolean
        category:
          type: string
          nullable: true
        recipeId:
          type: string
          nullable: true
        updatedAt:
          type: string
          format: date-time
    SyncShoppingItemInput:
      type: object
      required:
        - id
        - name
      properties:
        id:
          type: string
          description: Resource ID. Integer IDs are deprecated (coerced to string); use string IDs exclusively.
        name:
          type: string
        quantity:
          type: number
        unit:
          type: string
        isChecked:
          type: boolean
        category:
          type: string
        recipeId:
          type: string
        updatedAt:
          type: string
          format: date-time
        extraData:
          type: object
          nullable: true
          description: Additional client-defined fields preserved during sync.
      additionalProperties: false
    SyncUpdateResponse:
      description: Standard response for sync PUT operations (update with conflict resolution)
      type: object
      properties:
        success:
          type: boolean
          enum:
            - true
        data:
          type: object
          properties:
            syncedAt:
              type: string
              format: date-time
            operation:
              type: string
              enum:
                - update
                - skipped
            itemId:
              type: string
            reason:
              type: string
    UserAppliance:
      type: object
      properties:
        id:
          type: integer
        applianceId:
          type: integer
        notes:
          type: string
        brand:
          type: string
        createdAt:
          type: string
          format: date-time
        appliance:
          $ref: "#/components/schemas/Appliance"
    UserObject:
      type: object
      properties:
        id:
          type: string
          format: uuid
        email:
          type: string
          format: email
        displayName:
          type: string
          nullable: true
        avatarUrl:
          type: string
          nullable: true
        createdAt:
          type: string
          format: date-time
        subscriptionTier:
          type: string
          enum:
            - PRO
        subscriptionStatus:
          type: string
          enum:
            - active
            - trialing
            - canceled
            - expired
            - past_due
            - none
        trialEndsAt:
          type: string
          format: date-time
          nullable: true
paths:
  /api/admin/analytics:
    get:
      operationId: getAdminDashboard
      tags:
        - Admin - Analytics
      summary: Full admin analytics dashboard (users, subs, revenue, growth)
      security:
        - AdminAuth: []
      responses:
        "200":
          description: Dashboard metrics
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      userMetrics:
                        type: object
                        properties:
                          totalUsers:
                            type: integer
                          newUsersLast7Days:
                            type: integer
                          newUsersLast30Days:
                            type: integer
                          activeUsersLast7Days:
                            type: integer
                      subscriptionBreakdown:
                        type: object
                        properties:
                          pro:
                            type: integer
                          trialing:
                            type: integer
                          active:
                            type: integer
                          canceled:
                            type: integer
                          expired:
                            type: integer
                      revenueMetrics:
                        type: object
                        properties:
                          totalActiveSubscribers:
                            type: integer
                          monthlySubscribers:
                            type: integer
                          annualSubscribers:
                            type: integer
                          mrr:
                            type: integer
                          arr:
                            type: integer
                      aiUsage:
                        type: object
                        properties:
                          totalRecipesThisMonth:
                            type: integer
                      topFoodItems:
                        type: array
                        items:
                          type: object
                          properties:
                            name:
                              type: string
                            count:
                              type: integer
                      userGrowth:
                        type: array
                        items:
                          type: object
                          properties:
                            month:
                              type: string
                            count:
                              type: integer
        "401":
          description: Admin authentication required
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorEnvelope"
  /api/admin/analytics/advanced-metrics:
    get:
      operationId: getAdminAdvancedMetrics
      tags:
        - Admin - Analytics
      summary: MRR trend, churn, conversion, ARPU, and cohort retention
      security:
        - AdminAuth: []
      responses:
        "200":
          description: Advanced SaaS metrics
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      monthlyMRR:
                        type: array
                        items:
                          type: object
                          properties:
                            month:
                              type: string
                            mrr:
                              type: integer
                      monthlyChurn:
                        type: array
                        items:
                          type: object
                          properties:
                            month:
                              type: string
                            churnRate:
                              type: number
                            cancellations:
                              type: integer
                            activeAtStart:
                              type: integer
                      monthlyConversion:
                        type: array
                        items:
                          type: object
                          properties:
                            month:
                              type: string
                            conversionRate:
                              type: number
                            conversions:
                              type: integer
                            trialStarts:
                              type: integer
                      monthlyARPU:
                        type: array
                        items:
                          type: object
                          properties:
                            month:
                              type: string
                            arpu:
                              type: integer
                      cohortRetention:
                        type: array
                        items:
                          type: object
                          properties:
                            cohort:
                              type: string
                            retention:
                              type: array
                              items:
                                type: number
        "401":
          description: Admin authentication required
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorEnvelope"
  /api/admin/analytics/churn-rate:
    get:
      operationId: getAdminChurnRate
      tags:
        - Admin - Analytics
      summary: Monthly churn rate over the past 12 months
      security:
        - AdminAuth: []
      responses:
        "200":
          description: Churn data
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      monthlyChurn:
                        type: array
                        items:
                          type: object
                          properties:
                            month:
                              type: string
                            cancellations:
                              type: integer
                            churnRate:
                              type: number
                      currentMonthChurnRate:
                        type: number
                      totalCanceledAllTime:
                        type: integer
        "401":
          description: Admin authentication required
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorEnvelope"
  /api/admin/analytics/conversion-funnel:
    get:
      operationId: getAdminConversionFunnel
      tags:
        - Admin - Analytics
      summary: Free → Trial → Paid conversion funnel
      security:
        - AdminAuth: []
      responses:
        "200":
          description: Funnel data
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      trialUsers:
                        type: integer
                      proUsers:
                        type: integer
                      freeToTrialRate:
                        type: number
                      trialToPaidRate:
                        type: number
                      freeToPaidRate:
                        type: number
                      totalConversions:
                        type: integer
                      conversionBreakdown:
                        type: object
                        additionalProperties:
                          type: integer
                      recentBreakdown:
                        type: object
                        additionalProperties:
                          type: integer
        "401":
          description: Admin authentication required
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorEnvelope"
  /api/admin/analytics/subscription-metrics:
    get:
      operationId: getAdminSubscriptionMetrics
      tags:
        - Admin - Analytics
      summary: Tier counts, active counts, and MRR breakdown
      security:
        - AdminAuth: []
      responses:
        "200":
          description: Subscription metrics
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      tierCounts:
                        type: object
                      tierActiveCounts:
                        type: object
                      activeCounts:
                        type: object
                        properties:
                          proMonthly:
                            type: integer
                          proAnnual:
                            type: integer
                      mrrBreakdown:
                        type: object
                        properties:
                          proMonthlyMRR:
                            type: integer
                          proAnnualMRR:
                            type: integer
                          totalMRR:
                            type: integer
                      arr:
                        type: integer
        "401":
          description: Admin authentication required
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorEnvelope"
  /api/admin/analytics/trial-conversion:
    get:
      operationId: getAdminTrialConversion
      tags:
        - Admin - Analytics
      summary: Trial-to-paid conversion statistics
      security:
        - AdminAuth: []
      responses:
        "200":
          description: Trial conversion data
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      trialsStarted:
                        type: integer
                      trialsConverted:
                        type: integer
                      conversionRate:
                        type: number
                      currentlyTrialing:
                        type: integer
                      averageTrialDurationDays:
                        type: number
        "401":
          description: Admin authentication required
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorEnvelope"
  /api/admin/export-all-data:
    get:
      operationId: adminExportAllData
      tags:
        - Admin - Data Export
      summary: Stream a full JSON export of all application data
      security:
        - AdminAuth: []
      responses:
        "200":
          description: Streamed JSON file download
          headers:
            Content-Disposition:
              schema:
                type: string
                example: attachment; filename=chefspaice-export-2026-02-12.json
          content:
            application/json:
              schema:
                type: object
                properties:
                  users:
                    type: array
                    items:
                      type: object
                  subscriptions:
                    type: array
                    items:
                      type: object
                  userSyncData:
                    type: array
                    items:
                      type: object
                  userInventoryItems:
                    type: array
                    items:
                      type: object
                  userSavedRecipes:
                    type: array
                    items:
                      type: object
                  userMealPlans:
                    type: array
                    items:
                      type: object
                  userShoppingItems:
                    type: array
                    items:
                      type: object
                  userCookwareItems:
                    type: array
                    items:
                      type: object
                  feedbackBuckets:
                    type: array
                    items:
                      type: object
                  feedback:
                    type: array
                    items:
                      type: object
                  referrals:
                    type: array
                    items:
                      type: object
                  exportedAt:
                    type: string
                    format: date-time
        "401":
          description: Admin authentication required
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorEnvelope"
  /api/admin/subscriptions:
    get:
      operationId: listAdminSubscriptions
      tags:
        - Admin - Subscriptions
      summary: Paginated list of all subscriptions with user info
      security:
        - AdminAuth: []
      parameters:
        - name: status
          in: query
          schema:
            type: string
            enum:
              - all
              - active
              - trialing
              - past_due
              - canceled
              - expired
        - name: page
          in: query
          schema:
            type: integer
            minimum: 1
            default: 1
        - name: limit
          in: query
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 50
      responses:
        "200":
          description: Subscription list
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      subscriptions:
                        type: array
                        items:
                          $ref: "#/components/schemas/SubscriptionWithUser"
                      pagination:
                        type: object
                        properties:
                          page:
                            type: integer
                          limit:
                            type: integer
                          total:
                            type: integer
                          totalPages:
                            type: integer
        "401":
          description: Admin authentication required
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorEnvelope"
  /api/admin/subscriptions/stats:
    get:
      operationId: getAdminSubscriptionStats
      tags:
        - Admin - Subscriptions
      summary: Aggregate subscription statistics and MRR
      security:
        - AdminAuth: []
      responses:
        "200":
          description: Subscription statistics
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      totalActive:
                        type: integer
                      totalTrialing:
                        type: integer
                      totalPastDue:
                        type: integer
                      totalCanceled:
                        type: integer
                      totalSubscriptions:
                        type: integer
                      monthlyActive:
                        type: integer
                      annualActive:
                        type: integer
                      mrr:
                        type: integer
                      trialConversionRate:
                        type: integer
        "401":
          description: Admin authentication required
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorEnvelope"
  /api/admin/subscriptions/{id}:
    get:
      operationId: getAdminSubscriptionById
      tags:
        - Admin - Subscriptions
      summary: Get a single subscription with user details
      security:
        - AdminAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        "200":
          description: Subscription detail
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    $ref: "#/components/schemas/SubscriptionWithUser"
        "401":
          description: Admin authentication required
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorEnvelope"
        "404":
          description: Subscription not found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorEnvelope"
  /api/ai/analyze-food:
    post:
      operationId: analyzeFoodImage
      tags:
        - Image Analysis
      summary: Identify food items from an image
      description: |
        Upload a photo of food (groceries, fridge contents, etc.) and the AI will identify each food item with its name, category, quantity, recommended storage location, estimated shelf life, and confidence score.
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              required:
                - image
              properties:
                image:
                  type: string
                  format: binary
                  description: Image file (field name "image" or "file"). Max 20 MB. Supported formats – jpg, jpeg, png, gif, webp, bmp, tiff.
      responses:
        "200":
          description: Food items identified.
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: object
                    properties:
                      items:
                        type: array
                        items:
                          $ref: "#/components/schemas/FoodAnalysisItem"
                      notes:
                        type: string
                      error:
                        type: string
                        description: Present when no food items are detected.
        "400":
          description: Invalid request.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
              examples:
                invalidContentType:
                  value:
                    success: false
                    error: Expected multipart/form-data with image file
                    errorCode: INVALID_CONTENT_TYPE
                missingImage:
                  value:
                    success: false
                    error: No image file provided. Please upload an image with field name 'image' or 'file'
                    errorCode: MISSING_IMAGE_FILE
                emptyImage:
                  value:
                    success: false
                    error: The uploaded image file appears to be empty
                    errorCode: EMPTY_IMAGE_FILE
                fileTooLarge:
                  value:
                    success: false
                    error: Image file too large. Maximum size is 20MB
                    errorCode: FILE_TOO_LARGE
                invalidFormat:
                  value:
                    success: false
                    error: Invalid image format.
                    errorCode: INVALID_IMAGE_FORMAT
        "500":
          description: AI parse error.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
              example:
                success: false
                error: Failed to parse AI response
                errorCode: AI_PARSE_ERROR
  /api/ai/health:
    get:
      operationId: imageAnalysisHealthCheck
      tags:
        - Image Analysis
      summary: Image analysis service health check
      description: Returns supported image formats, max file size, and model information.
      security:
        - bearerAuth: []
      responses:
        "200":
          description: Health status.
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: object
                    properties:
                      status:
                        type: string
                        example: ok
                      supportedFormats:
                        type: array
                        items:
                          type: string
                      maxFileSize:
                        type: string
                        example: 20MB
                      model:
                        type: string
                        example: gpt-4o
  /api/analytics/waste-summary:
    get:
      operationId: getWasteSummary
      tags:
        - Analytics
      summary: Get food waste analytics summary with trends
      description: |
        Returns waste and consumption analytics for the authenticated user, including current period stats, weekly trends, and streak data. The period parameter controls whether current stats are calculated for the current week or month. Trend data shows weekly breakdown for the specified number of past weeks.
      security:
        - BearerAuth: []
      parameters:
        - name: period
          in: query
          required: false
          schema:
            type: string
            enum:
              - week
              - month
            default: month
          description: Time period for current stats calculation
        - name: weeks
          in: query
          required: false
          schema:
            type: integer
            default: 12
          description: Number of past weeks to include in trend data
      responses:
        "200":
          description: Waste analytics summary
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      currentPeriod:
                        type: object
                        properties:
                          wasteCount:
                            type: integer
                          consumedCount:
                            type: integer
                          totalItems:
                            type: integer
                          wasteScore:
                            type: integer
                            description: Score from 0-100, higher is better (less waste)
                          periodLabel:
                            type: string
                            example: This Month
                      trends:
                        type: array
                        items:
                          type: object
                          properties:
                            weekStart:
                              type: string
                              description: ISO date of the Monday of the week
                              example: 2026-02-09
                            wasteCount:
                              type: integer
                            consumedCount:
                              type: integer
                            wasteScore:
                              type: integer
                      streak:
                        type: object
                        properties:
                          currentStreak:
                            type: integer
                            description: Consecutive weeks with wasteScore >= 80
                          longestStreak:
                            type: integer
                          lastUpdated:
                            type: string
                            format: date-time
        "401":
          description: Authentication required
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorEnvelope"
  /api/appliances:
    get:
      tags:
        - Appliances
      operationId: listAppliances
      summary: List all appliances in the catalog
      description: |
        Returns the full catalog of kitchen appliances, optionally filtered by category. Results are cached for 24 hours. This is a public endpoint.
      security: []
      parameters:
        - name: category
          in: query
          schema:
            type: string
          description: Filter by category (e.g., essential, cooking, bakeware, small appliances, prep tools, specialty)
      responses:
        "200":
          description: List of appliances
          headers:
            Cache-Control:
              schema:
                type: string
                example: public, max-age=86400
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    enum:
                      - true
                  data:
                    type: array
                    items:
                      $ref: "#/components/schemas/Appliance"
  /api/appliances/common:
    get:
      tags:
        - Appliances
      operationId: listCommonAppliances
      summary: List commonly available appliances
      description: Returns only appliances marked as commonly available in kitchens.
      security: []
      responses:
        "200":
          description: List of common appliances
          headers:
            Cache-Control:
              schema:
                type: string
                example: public, max-age=86400
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    enum:
                      - true
                  data:
                    type: array
                    items:
                      $ref: "#/components/schemas/Appliance"
  /api/auth/account:
    delete:
      tags:
        - Account
      operationId: deleteAccount
      summary: Delete account with email confirmation
      description: |
        Permanently deletes the authenticated user's account and all associated data. Requires the user to confirm by providing their account email in the request body. The demo account (demo@chefspaice.com) is protected from deletion.
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - email
              properties:
                email:
                  type: string
                  format: email
                  description: Must match the user's account email for confirmation
      responses:
        "200":
          description: Account deleted
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    enum:
                      - true
                  data:
                    nullable: true
                  message:
                    type: string
                    example: Your account and all associated data have been permanently deleted.
        "400":
          description: Missing email or email mismatch
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "401":
          description: Not authenticated
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "403":
          description: Demo account cannot be deleted
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "404":
          description: User not found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
  /api/auth/delete-account:
    delete:
      tags:
        - Account
      operationId: deleteAccountLegacy
      summary: Delete account (legacy endpoint)
      description: |
        Permanently deletes the authenticated user's account and all associated data. Requires CSRF protection. Uses session token from Authorization header or auth cookie. The demo account (demo@chefspaice.com) is protected from deletion.
      security:
        - BearerAuth: []
      responses:
        "200":
          description: Account deleted
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    enum:
                      - true
                  data:
                    nullable: true
                  message:
                    type: string
                    example: Account and all associated data have been permanently deleted
        "401":
          description: Not authenticated or session expired
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "403":
          description: Demo account cannot be deleted
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "404":
          description: User not found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
  /api/auth/forgot-password:
    post:
      tags:
        - Auth
      operationId: forgotPassword
      summary: Request a password reset token
      description: |
        Generates a password reset token for the given email address. Always returns a success message regardless of whether the email exists (to prevent email enumeration). Rate limited.
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - email
              properties:
                email:
                  type: string
                  format: email
      responses:
        "200":
          description: Reset request accepted
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    enum:
                      - true
                  data:
                    type: object
                    properties:
                      message:
                        type: string
                        example: If an account with that email exists, a password reset link has been sent.
        "400":
          description: Missing email
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "429":
          description: Rate limit exceeded
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
  /api/auth/login:
    post:
      tags:
        - Auth
      operationId: login
      summary: Log in with email and password
      description: |
        Authenticates a user with email and password credentials. Returns user data, a session token, and a CSRF token. Also sets an HTTP-only auth cookie.
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - email
                - password
              properties:
                email:
                  type: string
                  format: email
                password:
                  type: string
                  format: password
      responses:
        "200":
          description: Login successful
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    enum:
                      - true
                  data:
                    type: object
                    properties:
                      user:
                        type: object
                        properties:
                          id:
                            type: string
                            format: uuid
                          email:
                            type: string
                            format: email
                          displayName:
                            type: string
                            nullable: true
                          avatarUrl:
                            type: string
                            nullable: true
                          createdAt:
                            type: string
                            format: date-time
                          subscriptionTier:
                            type: string
                          subscriptionStatus:
                            type: string
                          trialEndsAt:
                            type: string
                            format: date-time
                            nullable: true
                      token:
                        type: string
                        description: Bearer token for Authorization header
                      csrfToken:
                        type: string
                        description: CSRF token for state-changing requests
        "401":
          description: Invalid credentials
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
  /api/auth/logout:
    post:
      tags:
        - Auth
      operationId: logout
      summary: Log out and invalidate current session
      description: |
        Invalidates the current session token and clears the auth cookie. Requires CSRF protection. Always returns 200 even if logout fails internally.
      security:
        - BearerAuth: []
      requestBody:
        content:
          application/json:
            schema:
              type: object
      responses:
        "200":
          description: Logout successful
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    enum:
                      - true
                  data:
                    nullable: true
  /api/auth/me:
    get:
      tags:
        - Auth
      operationId: getCurrentUser
      summary: Get current authenticated user
      description: |
        Returns the profile of the currently authenticated user based on the Bearer token. Includes subscription information.
      security:
        - BearerAuth: []
      responses:
        "200":
          description: Current user data
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    enum:
                      - true
                  data:
                    type: object
                    properties:
                      user:
                        type: object
                        properties:
                          id:
                            type: string
                            format: uuid
                          email:
                            type: string
                            format: email
                          displayName:
                            type: string
                            nullable: true
                          createdAt:
                            type: string
                            format: date-time
                          subscriptionTier:
                            type: string
                          subscriptionStatus:
                            type: string
                          trialEndsAt:
                            type: string
                            format: date-time
                            nullable: true
        "401":
          description: Not authenticated or session expired
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
  /api/auth/migrate-guest-data:
    post:
      tags:
        - Account
      operationId: migrateGuestData
      summary: Migrate guest/offline data to authenticated account
      description: |
        Migrates locally stored guest data to the authenticated user's account. Merges with any existing server data. Supports all data sections including inventory, recipes, mealPlans, shoppingList, cookware, wasteLog, consumedLog, customLocations, preferences, onboarding, and userProfile. Enforces subscription limits for cookware and custom storage locations.
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - data
              properties:
                guestId:
                  type: string
                  description: Optional identifier for the guest session
                data:
                  type: object
                  description: Guest data to migrate, with optional sections
                  properties:
                    inventory:
                      type: array
                      items:
                        type: object
                    recipes:
                      type: array
                      items:
                        type: object
                    mealPlans:
                      type: array
                      items:
                        type: object
                    shoppingList:
                      type: array
                      items:
                        type: object
                    cookware:
                      type: array
                      items:
                        type: object
                    wasteLog:
                      type: array
                      items:
                        type: object
                    consumedLog:
                      type: array
                      items:
                        type: object
                    customLocations:
                      type: array
                      items:
                        type: object
                    preferences:
                      type: object
                    onboarding:
                      type: object
                    userProfile:
                      type: object
      responses:
        "200":
          description: Guest data migrated successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    enum:
                      - true
                  data:
                    type: object
                    properties:
                      migratedAt:
                        type: string
                        format: date-time
                      merged:
                        type: boolean
                        description: True if user had pre-existing data that was merged
        "400":
          description: No data provided for migration
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "401":
          description: Not authenticated
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
  /api/auth/register:
    post:
      tags:
        - Auth
      operationId: register
      summary: Register a new account with email and password
      description: |
        Creates a new user account with email/password credentials. Returns the new user profile, a session token, and a CSRF token. Also sets an HTTP-only auth cookie.
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - email
                - password
              properties:
                email:
                  type: string
                  format: email
                password:
                  type: string
                  format: password
                displayName:
                  type: string
                  description: Optional display name for the user
                selectedPlan:
                  type: string
                  enum:
                    - monthly
                    - annual
                  description: Selected subscription billing plan
                referralCode:
                  type: string
                  description: Optional referral code from an existing user
      responses:
        "201":
          description: Registration successful
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    enum:
                      - true
                  data:
                    type: object
                    properties:
                      user:
                        type: object
                        properties:
                          id:
                            type: string
                            format: uuid
                          email:
                            type: string
                            format: email
                          displayName:
                            type: string
                            nullable: true
                          createdAt:
                            type: string
                            format: date-time
                          subscriptionTier:
                            type: string
                          subscriptionStatus:
                            type: string
                          trialEndsAt:
                            type: string
                            format: date-time
                            nullable: true
                      token:
                        type: string
                        description: Bearer token for Authorization header
                      csrfToken:
                        type: string
                        description: CSRF token for state-changing requests
        "400":
          description: Validation error (e.g., weak password, invalid email)
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "409":
          description: Email already in use
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
  /api/auth/reset-password:
    post:
      tags:
        - Auth
      operationId: resetPassword
      summary: Reset password using a reset token
      description: |
        Resets the user's password using a previously generated reset token. Invalidates all existing sessions after password change. The token expires after 1 hour. Rate limited.
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - token
                - password
              properties:
                token:
                  type: string
                  description: The password reset token received via email
                password:
                  type: string
                  format: password
                  description: The new password (must meet strength requirements)
      responses:
        "200":
          description: Password reset successful
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    enum:
                      - true
                  data:
                    type: object
                    properties:
                      message:
                        type: string
                        example: Password has been reset successfully.
        "400":
          description: Missing fields, weak password, or invalid/expired token
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "429":
          description: Rate limit exceeded
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
  /api/auth/restore-session:
    get:
      tags:
        - Auth
      operationId: restoreSession
      summary: Restore session from auth cookie
      description: |
        Restores a user session using the HTTP-only auth cookie. Returns the user profile, the session token, and a fresh CSRF token. Used by clients to silently re-authenticate on app launch.
      security: []
      responses:
        "200":
          description: Session restored successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    enum:
                      - true
                  data:
                    type: object
                    properties:
                      user:
                        type: object
                        properties:
                          id:
                            type: string
                            format: uuid
                          email:
                            type: string
                            format: email
                          displayName:
                            type: string
                            nullable: true
                          createdAt:
                            type: string
                            format: date-time
                          subscriptionTier:
                            type: string
                          subscriptionStatus:
                            type: string
                          trialEndsAt:
                            type: string
                            format: date-time
                            nullable: true
                      token:
                        type: string
                        description: Bearer token for Authorization header
                      csrfToken:
                        type: string
                        description: CSRF token for state-changing requests
        "401":
          description: No session cookie or session expired
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
  /api/auth/sessions:
    get:
      tags:
        - Auth
      operationId: listSessions
      summary: List active sessions
      description: |
        Returns all active (non-expired) sessions for the authenticated user. Each session includes device info, masked IP address, and whether it is the current session.
      security:
        - BearerAuth: []
      responses:
        "200":
          description: List of active sessions
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    enum:
                      - true
                  data:
                    type: object
                    properties:
                      sessions:
                        type: array
                        items:
                          type: object
                          properties:
                            id:
                              type: integer
                            userAgent:
                              type: string
                              example: Mozilla/5.0 ...
                            ipAddress:
                              type: string
                              description: Masked IP address (e.g., 192.168.*.*)
                            createdAt:
                              type: string
                              format: date-time
                            expiresAt:
                              type: string
                              format: date-time
                            isCurrent:
                              type: boolean
        "401":
          description: Not authenticated
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
    delete:
      tags:
        - Auth
      operationId: revokeAllOtherSessions
      summary: Revoke all other sessions
      description: |
        Revokes all sessions for the authenticated user except the current session. Requires the current session token to identify which session to keep.
      security:
        - BearerAuth: []
      responses:
        "200":
          description: Other sessions revoked
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    enum:
                      - true
                  data:
                    type: object
                    properties:
                      message:
                        type: string
                        example: Revoked 3 other session(s)
        "400":
          description: Unable to identify current session
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "401":
          description: Not authenticated
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
  /api/auth/sessions/{sessionId}:
    delete:
      tags:
        - Auth
      operationId: revokeSession
      summary: Revoke a specific session
      description: |
        Revokes (deletes) a specific session by its ID. The session must belong to the authenticated user.
      security:
        - BearerAuth: []
      parameters:
        - name: sessionId
          in: path
          required: true
          schema:
            type: integer
          description: The ID of the session to revoke
      responses:
        "200":
          description: Session revoked
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    enum:
                      - true
                  data:
                    type: object
                    properties:
                      message:
                        type: string
                        example: Session revoked successfully
        "401":
          description: Not authenticated
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "404":
          description: Session not found or does not belong to user
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
  /api/auth/social/apple:
    post:
      tags:
        - Auth
      operationId: socialLoginApple
      summary: Sign in with Apple
      description: |
        Authenticates a user via Apple Sign In. Supports both native iOS flow (identity token verification) and web OAuth flow (authorization code exchange). Creates a new user if one does not exist, or links to an existing account by email. Returns user data and a session token.
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                identityToken:
                  type: string
                  description: Apple identity token (for native iOS flow)
                authorizationCode:
                  type: string
                  description: Apple authorization code (for web OAuth flow)
                isWebAuth:
                  type: boolean
                  description: Set to true for web OAuth flow
                redirectUri:
                  type: string
                  description: Redirect URI used in the web auth request
                selectedPlan:
                  type: string
                  enum:
                    - monthly
                    - annual
                  description: Selected subscription billing plan
                selectedTier:
                  type: string
                  enum:
                    - basic
                    - pro
                  description: Selected subscription tier
                user:
                  type: object
                  properties:
                    email:
                      type: string
                      format: email
                  description: User info provided by Apple on first sign-in
      responses:
        "200":
          description: Apple sign-in successful
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    enum:
                      - true
                  data:
                    type: object
                    properties:
                      user:
                        type: object
                        properties:
                          id:
                            type: string
                            format: uuid
                          email:
                            type: string
                            format: email
                          displayName:
                            type: string
                            nullable: true
                          avatarUrl:
                            type: string
                            nullable: true
                          provider:
                            type: string
                            enum:
                              - apple
                          isNewUser:
                            type: boolean
                            description: True if a new account was created
                          createdAt:
                            type: string
                            format: date-time
                      token:
                        type: string
                        description: Bearer token for Authorization header
                      expiresAt:
                        type: string
                        format: date-time
        "400":
          description: Incomplete sign-in request
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "401":
          description: Token verification failed
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
  /api/auth/social/google:
    post:
      tags:
        - Auth
      operationId: socialLoginGoogle
      summary: Sign in with Google
      description: |
        Authenticates a user via Google OAuth. Verifies the Google ID token against configured client IDs (web, iOS, Android). Creates a new user if one does not exist, or links to an existing account by email. Returns user data and a session token.
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - idToken
              properties:
                idToken:
                  type: string
                  description: Google OAuth ID token
                accessToken:
                  type: string
                  description: Optional Google access token (stored encrypted)
                selectedPlan:
                  type: string
                  enum:
                    - monthly
                    - annual
                  description: Selected subscription billing plan for new users
      responses:
        "200":
          description: Google sign-in successful
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    enum:
                      - true
                  data:
                    type: object
                    properties:
                      user:
                        type: object
                        properties:
                          id:
                            type: string
                            format: uuid
                          email:
                            type: string
                            format: email
                          displayName:
                            type: string
                            nullable: true
                          avatarUrl:
                            type: string
                            nullable: true
                          provider:
                            type: string
                            enum:
                              - google
                          isNewUser:
                            type: boolean
                            description: True if a new account was created
                          createdAt:
                            type: string
                            format: date-time
                      token:
                        type: string
                        description: Bearer token for Authorization header
                      expiresAt:
                        type: string
                        format: date-time
        "400":
          description: Missing ID token
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "401":
          description: Invalid Google token
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "500":
          description: Google authentication not configured on server
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
  /api/auth/sync:
    get:
      tags:
        - Account
      operationId: getSyncData
      summary: Get user sync data
      description: |
        Returns all synced data for the authenticated user including inventory, recipes, meal plans, shopping list, cookware, waste log, consumed log, custom locations, and preferences. Supports delta sync via the lastSyncedAt query parameter—if the server data has not changed since the client's timestamp, returns `unchanged: true`.
      security:
        - BearerAuth: []
      parameters:
        - name: lastSyncedAt
          in: query
          required: false
          schema:
            type: string
            format: date-time
          description: ISO 8601 timestamp of last successful sync. Enables delta sync.
      responses:
        "200":
          description: Sync data returned (full or delta)
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    enum:
                      - true
                  data:
                    type: object
                    properties:
                      data:
                        type: object
                        nullable: true
                        description: |
                          All synced data sections (inventory, recipes, mealPlans, shoppingList, cookware, wasteLog, consumedLog, customLocations, preferences, analytics, onboarding, userProfile). Null when unchanged is true.
                      unchanged:
                        type: boolean
                        description: True if no data has changed since lastSyncedAt
                      delta:
                        type: boolean
                        description: True if response contains only changed sections
                      lastSyncedAt:
                        type: string
                        format: date-time
                        nullable: true
                      serverTimestamp:
                        type: string
                        format: date-time
        "401":
          description: Not authenticated
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
    post:
      tags:
        - Account
      operationId: postSyncData
      summary: Push sync data to server
      description: |
        Uploads the user's local data to the server. Each data section (inventory, recipes, mealPlans, shoppingList, cookware, wasteLog, consumedLog, customLocations, preferences, analytics, onboarding, userProfile) is optional. Sections provided will replace existing server data for that section. Validates preferences against a schema and enforces subscription limits for cookware and custom storage locations.
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - data
              properties:
                data:
                  type: object
                  description: Object with optional data sections to sync
                  properties:
                    inventory:
                      type: array
                      items:
                        type: object
                    recipes:
                      type: array
                      items:
                        type: object
                    mealPlans:
                      type: array
                      items:
                        type: object
                    shoppingList:
                      type: array
                      items:
                        type: object
                    cookware:
                      type: array
                      items:
                        type: object
                    wasteLog:
                      type: array
                      items:
                        type: object
                    consumedLog:
                      type: array
                      items:
                        type: object
                    customLocations:
                      type: array
                      items:
                        type: object
                    preferences:
                      type: object
                    analytics:
                      type: object
                    onboarding:
                      type: object
                    userProfile:
                      type: object
      responses:
        "200":
          description: Sync successful
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    enum:
                      - true
                  data:
                    type: object
                    properties:
                      syncedAt:
                        type: string
                        format: date-time
                      prefsSynced:
                        type: boolean
                        description: Whether preferences were validated and saved successfully
                      prefsError:
                        type: string
                        description: Validation error message if prefsSynced is false
        "401":
          description: Not authenticated
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "403":
          description: Subscription limit reached (cookware or custom locations)
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
  /api/chat:
    post:
      operationId: chatWithAssistant
      tags:
        - Chat
      summary: AI kitchen assistant chat
      description: |
        Send a message to the AI kitchen assistant (ChefSpAIce). The assistant can answer cooking questions, manage inventory via function-calling, generate recipes, create meal plans, and more. Authenticated users get actionable capabilities through OpenAI tool calls; unauthenticated users receive advice only.
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - message
              properties:
                message:
                  type: string
                  description: The user's chat message.
                  example: What can I cook with chicken and rice?
                context:
                  type: string
                  description: Optional free-text context about the user's inventory.
                history:
                  type: array
                  description: Previous conversation turns for multi-turn context.
                  items:
                    type: object
                    required:
                      - role
                      - content
                    properties:
                      role:
                        type: string
                        enum:
                          - user
                          - assistant
                      content:
                        type: string
                inventory:
                  type: array
                  description: Client-supplied inventory items (used when the user is not authenticated).
                  items:
                    type: object
                    properties:
                      name:
                        type: string
                      quantity:
                        type: number
                      unit:
                        type: string
                preferences:
                  type: object
                  description: User dietary preferences (overridden by server-side data for authenticated users).
                  properties:
                    dietaryRestrictions:
                      type: array
                      items:
                        type: string
                    cuisinePreferences:
                      type: array
                      items:
                        type: string
                    macroTargets:
                      type: object
                      properties:
                        calories:
                          type: number
                        protein:
                          type: number
                        carbs:
                          type: number
                        fat:
                          type: number
                equipment:
                  type: array
                  description: IDs or objects representing kitchen equipment the user owns.
                  items:
                    oneOf:
                      - type: integer
                      - type: object
                        properties:
                          id:
                            type: integer
      responses:
        "200":
          description: Successful chat response.
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: object
                    properties:
                      reply:
                        type: string
                        description: The assistant's text reply.
                      actions:
                        type: array
                        description: Results of function-calling actions executed on behalf of the user (only present when tool calls are made).
                        items:
                          type: object
                      refreshData:
                        type: boolean
                        description: When true the client should refresh its local data caches.
                      navigateTo:
                        type: object
                        description: Optional navigation instruction for the client.
                        properties:
                          screen:
                            type: string
                          params:
                            type: object
        "400":
          description: Bad request – message is missing.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
              example:
                success: false
                error: Message is required
                errorCode: MISSING_MESSAGE
        "403":
          description: Feature not available – subscription required.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
              example:
                success: false
                error: Live AI Kitchen Assistant requires an active subscription.
                errorCode: FEATURE_NOT_AVAILABLE
        "429":
          description: Rate limit exceeded.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
  /api/cooking-terms:
    get:
      tags:
        - Cooking Terms
      operationId: listCookingTerms
      summary: List cooking term definitions
      description: |
        Returns all cooking term definitions, optionally filtered by category or search query. Results are sorted alphabetically by term, with search results prioritized by relevance.
      security: []
      parameters:
        - name: category
          in: query
          schema:
            type: string
          description: Filter by category (use "all" or omit for no filter)
        - name: search
          in: query
          schema:
            type: string
          description: Search terms by name or definition
      responses:
        "200":
          description: List of cooking terms
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    enum:
                      - true
                  data:
                    type: array
                    items:
                      $ref: "#/components/schemas/CookingTerm"
  /api/cooking-terms/detect:
    get:
      tags:
        - Cooking Terms
      operationId: detectCookingTerms
      summary: Detect cooking terms in text
      description: |
        Scans the provided text for known cooking terms and returns matching term definitions. Useful for highlighting cooking terms in recipe instructions.
      security: []
      parameters:
        - name: text
          in: query
          required: true
          schema:
            type: string
          description: Text to scan for cooking terms
      responses:
        "200":
          description: Detected cooking terms
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    enum:
                      - true
                  data:
                    type: array
                    items:
                      $ref: "#/components/schemas/CookingTerm"
        "400":
          description: Missing text parameter
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
  /api/cooking-terms/{id}:
    get:
      tags:
        - Cooking Terms
      operationId: getCookingTerm
      summary: Get a single cooking term by ID
      description: |
        Returns a single cooking term definition. If the term has related terms, their full details are included in relatedTermDetails.
      security: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        "200":
          description: Cooking term details
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    enum:
                      - true
                  data:
                    allOf:
                      - $ref: "#/components/schemas/CookingTerm"
                      - type: object
                        properties:
                          relatedTermDetails:
                            type: array
                            items:
                              $ref: "#/components/schemas/CookingTerm"
        "400":
          description: Invalid term ID
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "404":
          description: Cooking term not found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
  /api/donations/create-checkout-session:
    post:
      operationId: createDonationCheckoutSession
      tags:
        - Donations
      summary: Create a Stripe one-time payment session for a donation
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - amount
                - successUrl
                - cancelUrl
              properties:
                amount:
                  type: integer
                  minimum: 100
                  description: Amount in cents (USD)
                anonymous:
                  type: boolean
                successUrl:
                  type: string
                  format: uri
                cancelUrl:
                  type: string
                  format: uri
      responses:
        "200":
          description: Checkout session URL
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      url:
                        type: string
                        format: uri
        "400":
          description: Invalid amount or redirect URLs
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorEnvelope"
  /api/error-report:
    post:
      operationId: submitErrorReport
      tags:
        - Error Reports
      summary: Submit a client-side crash / error report
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - errorMessage
              properties:
                errorMessage:
                  type: string
                  minLength: 1
                  maxLength: 10000
                stackTrace:
                  type: string
                  maxLength: 50000
                componentStack:
                  type: string
                  maxLength: 50000
                screenName:
                  type: string
                  maxLength: 255
                platform:
                  type: string
                  maxLength: 50
                appVersion:
                  type: string
                  maxLength: 50
                deviceInfo:
                  type: string
                  maxLength: 2000
      responses:
        "201":
          description: Report persisted
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      reportId:
                        type: integer
        "400":
          description: Validation error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorEnvelope"
  /api/external/action:
    post:
      operationId: externalAction
      tags:
        - External API
      summary: Execute an action via API key (Siri Shortcuts)
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - apiKey
                - action
              properties:
                apiKey:
                  type: string
                action:
                  type: string
                  enum:
                    - add_item
                    - check_inventory
                    - what_expires
                    - quick_recipe
                item:
                  type: string
                quantity:
                  type: number
                unit:
                  type: string
      responses:
        "200":
          description: Action result
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                  message:
                    type: string
        "400":
          description: Invalid request
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorEnvelope"
        "401":
          description: Invalid API key
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorEnvelope"
        "403":
          description: Pantry limit reached
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorEnvelope"
  /api/external/generate-key:
    post:
      operationId: generateExternalApiKey
      tags:
        - External API
      summary: Generate a new external API key for the authenticated user
      security:
        - BearerAuth: []
      responses:
        "200":
          description: New API key (shown once)
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      apiKey:
                        type: string
                  message:
                    type: string
        "401":
          description: Authentication required
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorEnvelope"
        "404":
          description: User not found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorEnvelope"
  /api/external/revoke-key:
    delete:
      operationId: revokeExternalApiKey
      tags:
        - External API
      summary: Revoke the current external API key
      security:
        - BearerAuth: []
      responses:
        "200":
          description: Key revoked
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  message:
                    type: string
        "401":
          description: Authentication required
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorEnvelope"
  /api/feedback:
    post:
      operationId: submitFeedback
      tags:
        - Feedback
      summary: Submit user feedback or bug report (optionally authenticated)
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - type
                - message
              properties:
                type:
                  type: string
                  enum:
                    - feedback
                    - bug
                category:
                  type: string
                message:
                  type: string
                  minLength: 1
                userEmail:
                  type: string
                  format: email
                  nullable: true
                deviceInfo:
                  type: string
                screenContext:
                  type: string
                stepsToReproduce:
                  type: string
                severity:
                  type: string
                  enum:
                    - minor
                    - major
                    - critical
      responses:
        "200":
          description: Feedback submitted
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      id:
                        type: integer
                  message:
                    type: string
        "400":
          description: Validation error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorEnvelope"
    get:
      operationId: listFeedback
      tags:
        - Feedback
      summary: List all feedback items (admin only)
      security:
        - BearerAuth: []
      parameters:
        - name: status
          in: query
          schema:
            type: string
            enum:
              - all
              - new
              - reviewed
              - in_progress
              - resolved
              - closed
        - name: type
          in: query
          schema:
            type: string
            enum:
              - all
              - feedback
              - bug
        - name: priority
          in: query
          schema:
            type: string
            enum:
              - all
              - low
              - medium
              - high
              - urgent
      responses:
        "200":
          description: Feedback list
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      feedback:
                        type: array
                        items:
                          type: object
        "401":
          description: Admin authentication required
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorEnvelope"
  /api/feedback/buckets:
    get:
      operationId: listFeedbackBuckets
      tags:
        - Feedback
      summary: List feedback buckets with their items (admin only)
      security:
        - BearerAuth: []
      parameters:
        - name: status
          in: query
          schema:
            type: string
            enum:
              - all
              - open
              - in_progress
              - completed
      responses:
        "200":
          description: Buckets with items
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      buckets:
                        type: array
                        items:
                          type: object
        "401":
          description: Admin authentication required
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorEnvelope"
  /api/feedback/buckets/{id}/complete:
    post:
      operationId: completeFeedbackBucket
      tags:
        - Feedback
      summary: Mark a bucket and all its items as completed (admin)
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        "200":
          description: Bucket completed
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  message:
                    type: string
        "400":
          description: Invalid bucket ID
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorEnvelope"
        "401":
          description: Admin authentication required
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorEnvelope"
  /api/feedback/buckets/{id}/generate-prompt:
    post:
      operationId: generateBucketPrompt
      tags:
        - Feedback
      summary: Generate an AI implementation prompt for a feedback bucket (admin)
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        "200":
          description: Generated prompt
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      prompt:
                        type: string
                      bucketId:
                        type: integer
        "400":
          description: Invalid bucket ID or empty bucket
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorEnvelope"
        "401":
          description: Admin authentication required
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorEnvelope"
        "404":
          description: Bucket not found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorEnvelope"
  /api/feedback/categorize-uncategorized:
    post:
      operationId: categorizeUncategorizedFeedback
      tags:
        - Feedback
      summary: Run AI categorization on all uncategorized feedback (admin)
      security:
        - BearerAuth: []
      responses:
        "200":
          description: Categorization results
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  message:
                    type: string
        "401":
          description: Admin authentication required
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorEnvelope"
  /api/feedback/stats:
    get:
      operationId: getFeedbackStats
      tags:
        - Feedback
      summary: Feedback statistics by status, type, and buckets (admin only)
      security:
        - BearerAuth: []
      responses:
        "200":
          description: Feedback stats
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      total:
                        type: integer
                      uncategorized:
                        type: integer
                      byStatus:
                        type: object
                      byType:
                        type: object
                      buckets:
                        type: object
        "401":
          description: Admin authentication required
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorEnvelope"
  /api/feedback/{id}:
    get:
      operationId: getFeedbackById
      tags:
        - Feedback
      summary: Get a single feedback item (admin)
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        "200":
          description: Feedback item
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
        "400":
          description: Invalid feedback ID
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorEnvelope"
        "401":
          description: Admin authentication required
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorEnvelope"
        "404":
          description: Feedback not found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorEnvelope"
    patch:
      operationId: updateFeedback
      tags:
        - Feedback
      summary: Update a feedback item (status, priority, notes – admin)
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                status:
                  type: string
                  enum:
                    - new
                    - reviewed
                    - in_progress
                    - resolved
                    - closed
                priority:
                  type: string
                  enum:
                    - low
                    - medium
                    - high
                    - urgent
                adminNotes:
                  type: string
                  nullable: true
                resolutionPrompt:
                  type: string
                  nullable: true
                assignedTo:
                  type: string
                  nullable: true
                bucketId:
                  type: integer
                  nullable: true
      responses:
        "200":
          description: Updated feedback item
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
        "400":
          description: Invalid data
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorEnvelope"
        "401":
          description: Admin authentication required
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorEnvelope"
        "404":
          description: Feedback not found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorEnvelope"
  /api/health:
    get:
      operationId: getHealthCheck
      tags:
        - Health
      summary: Health check with database pool status
      security: []
      responses:
        "200":
          description: System healthy
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: object
                    properties:
                      status:
                        type: string
                        enum:
                          - ok
                          - degraded
                      timestamp:
                        type: string
                        format: date-time
                      database:
                        type: object
                        properties:
                          healthy:
                            type: boolean
                          responseTimeMs:
                            type: number
                          pool:
                            type: object
        "503":
          description: System degraded
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SuccessEnvelope"
    head:
      operationId: headHealthCheck
      tags:
        - Health
      summary: Lightweight health probe (no body)
      security: []
      responses:
        "200":
          description: OK
  /api/ingredients/scan:
    post:
      tags:
        - Ingredients
      operationId: scanIngredientLabel
      summary: Scan an ingredient label from a photo
      description: |
        Uses AI vision to extract product name, ingredients, and nutrition information from a photo of a food product label. Accepts either multipart/form-data with an image file or application/json with base64-encoded image data.
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - image
              properties:
                image:
                  type: string
                  description: Base64-encoded image data
          multipart/form-data:
            schema:
              type: object
              properties:
                image:
                  type: string
                  format: binary
                  description: Image file (max 10MB)
      responses:
        "200":
          description: Ingredient label scanned
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    enum:
                      - true
                  data:
                    type: object
                    properties:
                      productName:
                        type: string
                        nullable: true
                      ingredients:
                        type: array
                        items:
                          type: object
                          properties:
                            name:
                              type: string
                            simplifiedName:
                              type: string
                            category:
                              type: string
                            storageLocation:
                              type: string
                      nutrition:
                        type: object
                        nullable: true
                        properties:
                          servingSize:
                            type: string
                          servingsPerContainer:
                            type: number
                          calories:
                            type: number
                          protein:
                            type: number
                          carbs:
                            type: number
                          fat:
                            type: number
                          fiber:
                            type: number
                          sugar:
                            type: number
                          sodium:
                            type: number
                      rawText:
                        type: string
                      confidence:
                        type: number
                        minimum: 0
                        maximum: 1
                      notes:
                        type: string
        "400":
          description: No image provided, empty image, or invalid content type
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "401":
          description: Authentication required
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
  /api/instacart/products-link:
    post:
      operationId: createInstacartProductsLink
      tags:
        - Instacart
      summary: Create an Instacart shopping-list link for products
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - products
              properties:
                title:
                  type: string
                  default: Shopping List
                products:
                  type: array
                  minItems: 1
                  items:
                    $ref: "#/components/schemas/InstacartLineItemInput"
                linkbackUrl:
                  type: string
                  format: uri
                retailer_key:
                  type: string
      responses:
        "200":
          description: Instacart link generated
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
        "400":
          description: Missing or invalid products
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorEnvelope"
  /api/instacart/recipe:
    post:
      operationId: createInstacartRecipeLink
      tags:
        - Instacart
      summary: Create an Instacart recipe shopping link
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - title
                - ingredients
              properties:
                title:
                  type: string
                ingredients:
                  type: array
                  minItems: 1
                  items:
                    $ref: "#/components/schemas/InstacartLineItemInput"
                servings:
                  type: integer
                  minimum: 1
                cooking_time:
                  type: integer
                  minimum: 1
                instructions:
                  type: array
                  items:
                    type: string
                imageUrl:
                  type: string
                  format: uri
                linkbackUrl:
                  type: string
                  format: uri
                enable_pantry_items:
                  type: boolean
                retailer_key:
                  type: string
      responses:
        "200":
          description: Recipe link generated
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
        "400":
          description: Missing title or invalid ingredients
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorEnvelope"
  /api/instacart/retailers:
    get:
      operationId: getInstacartRetailers
      tags:
        - Instacart
      summary: Find nearby Instacart retailers by postal code
      security: []
      parameters:
        - name: postal_code
          in: query
          required: true
          schema:
            type: string
        - name: country_code
          in: query
          required: true
          schema:
            type: string
      responses:
        "200":
          description: Retailer list from Instacart
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
        "400":
          description: Missing params or Instacart not configured
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorEnvelope"
  /api/instacart/status:
    get:
      operationId: getInstacartStatus
      tags:
        - Instacart
      summary: Check whether the Instacart integration is configured
      security: []
      responses:
        "200":
          description: Configuration status
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      configured:
                        type: boolean
                  message:
                    type: string
  /api/logo:
    get:
      operationId: getLogoDownloadPage
      tags:
        - Logo
      summary: Serve the logo downloads HTML page
      security: []
      responses:
        "200":
          description: HTML page with download links
          content:
            text/html:
              schema:
                type: string
  /api/logo/apple-touch-icon:
    get:
      operationId: getAppleTouchIcon
      tags:
        - Logo
      summary: Download Apple touch icon (180 × 180 PNG)
      security: []
      responses:
        "200":
          description: PNG file
          content:
            image/png:
              schema:
                type: string
                format: binary
  /api/logo/favicon-png:
    get:
      operationId: getFaviconPng
      tags:
        - Logo
      summary: Download favicon as PNG at standard sizes
      security: []
      parameters:
        - name: size
          in: query
          schema:
            type: integer
            enum:
              - 16
              - 32
              - 48
              - 64
              - 128
              - 256
            default: 32
      responses:
        "200":
          description: PNG file
          content:
            image/png:
              schema:
                type: string
                format: binary
  /api/logo/favicon.ico:
    get:
      operationId: getFavicon
      tags:
        - Logo
      summary: Download favicon.ico (32 × 32)
      security: []
      responses:
        "200":
          description: ICO file
          content:
            image/x-icon:
              schema:
                type: string
                format: binary
  /api/logo/icon-svg:
    get:
      operationId: getIconOnlySvg
      tags:
        - Logo
      summary: Download chef-hat icon SVG (no background)
      security: []
      parameters:
        - name: size
          in: query
          schema:
            type: integer
            default: 512
      responses:
        "200":
          description: SVG file
          content:
            image/svg+xml:
              schema:
                type: string
  /api/logo/png:
    get:
      operationId: getLogoPng
      tags:
        - Logo
      summary: Download logo as PNG
      security: []
      parameters:
        - name: size
          in: query
          schema:
            type: integer
            default: 512
        - name: background
          in: query
          schema:
            type: string
            enum:
              - "true"
              - "false"
            default: "true"
      responses:
        "200":
          description: PNG file
          content:
            image/png:
              schema:
                type: string
                format: binary
  /api/logo/svg:
    get:
      operationId: getLogoSvg
      tags:
        - Logo
      summary: Download logo as SVG
      security: []
      parameters:
        - name: size
          in: query
          schema:
            type: integer
            default: 512
        - name: background
          in: query
          schema:
            type: string
            enum:
              - "true"
              - "false"
            default: "true"
      responses:
        "200":
          description: SVG file
          content:
            image/svg+xml:
              schema:
                type: string
  /api/notifications:
    get:
      tags:
        - Notifications
      operationId: getUnreadNotifications
      summary: Get unread notifications
      description: Returns all unread notifications for the authenticated user.
      security:
        - BearerAuth: []
      responses:
        "200":
          description: Unread notifications
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    enum:
                      - true
                  data:
                    type: array
                    items:
                      $ref: "#/components/schemas/Notification"
        "401":
          description: Authentication required
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
  /api/notifications/all:
    get:
      tags:
        - Notifications
      operationId: getAllNotifications
      summary: Get all notifications
      description: Returns all notifications for the authenticated user, ordered by most recent, with a configurable limit.
      security:
        - BearerAuth: []
      parameters:
        - name: limit
          in: query
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 50
      responses:
        "200":
          description: All notifications
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    enum:
                      - true
                  data:
                    type: array
                    items:
                      $ref: "#/components/schemas/Notification"
        "401":
          description: Authentication required
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
  /api/notifications/read-all:
    post:
      tags:
        - Notifications
      operationId: markAllNotificationsRead
      summary: Mark all notifications as read
      security:
        - BearerAuth: []
      responses:
        "200":
          description: All notifications marked as read
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    enum:
                      - true
                  data:
                    type: object
                    properties:
                      marked:
                        type: boolean
                        enum:
                          - true
        "401":
          description: Authentication required
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
  /api/notifications/register-device:
    post:
      tags:
        - Notifications
      operationId: registerDeviceForNotifications
      summary: Register a device for push notifications
      description: |
        Registers or updates a push notification token for the authenticated user's device. If the token already exists, updates the associated user and platform. This is the preferred endpoint for push token registration, replacing the deprecated /api/user/push-token endpoint.
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - token
                - platform
              properties:
                token:
                  type: string
                  minLength: 1
                  description: The device's push notification token (e.g., Expo push token)
                platform:
                  type: string
                  minLength: 1
                  description: The device platform (e.g., "ios", "android")
      responses:
        "200":
          description: Device registered successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    enum:
                      - true
                  data:
                    type: object
                    properties:
                      registered:
                        type: boolean
                        enum:
                          - true
        "400":
          description: Missing or invalid token/platform
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "401":
          description: Authentication required
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
  /api/notifications/{id}/read:
    post:
      tags:
        - Notifications
      operationId: markNotificationRead
      summary: Mark a notification as read
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        "200":
          description: Notification marked as read
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    enum:
                      - true
                  data:
                    type: object
                    properties:
                      marked:
                        type: boolean
                        enum:
                          - true
        "400":
          description: Invalid notification ID
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "401":
          description: Authentication required
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
  /api/nutrition/corrections:
    post:
      tags:
        - Nutrition
      operationId: submitNutritionCorrection
      summary: Submit a nutrition data correction
      description: |
        Submits a correction for inaccurate nutrition data. The correction is stored with "pending" status for review.
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - productName
              properties:
                productName:
                  type: string
                  minLength: 1
                barcode:
                  type: string
                brand:
                  type: string
                originalSource:
                  type: string
                originalSourceId:
                  type: string
                originalNutrition:
                  type: string
                correctedNutrition:
                  type: string
                imageUrl:
                  type: string
                notes:
                  type: string
      responses:
        "201":
          description: Correction submitted
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    enum:
                      - true
                  data:
                    type: object
                    properties:
                      id:
                        type: integer
                  message:
                    type: string
                    example: Correction submitted successfully
        "400":
          description: Validation error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "401":
          description: Authentication required
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
    get:
      tags:
        - Nutrition
      operationId: listNutritionCorrections
      summary: List nutrition corrections
      description: Returns a paginated list of nutrition corrections, optionally filtered by status.
      security:
        - BearerAuth: []
      parameters:
        - name: status
          in: query
          schema:
            type: string
            enum:
              - pending
              - reviewed
              - approved
              - rejected
        - name: limit
          in: query
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 50
        - name: offset
          in: query
          schema:
            type: integer
            default: 0
      responses:
        "200":
          description: List of corrections
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    enum:
                      - true
                  data:
                    type: object
                    properties:
                      corrections:
                        type: array
                        items:
                          type: object
                          properties:
                            id:
                              type: integer
                            userId:
                              type: string
                              nullable: true
                            productName:
                              type: string
                            barcode:
                              type: string
                              nullable: true
                            brand:
                              type: string
                              nullable: true
                            status:
                              type: string
                              enum:
                                - pending
                                - reviewed
                                - approved
                                - rejected
                            createdAt:
                              type: string
                              format: date-time
                      count:
                        type: integer
                      limit:
                        type: integer
                      offset:
                        type: integer
        "401":
          description: Authentication required
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
  /api/nutrition/corrections/{id}:
    patch:
      tags:
        - Nutrition
      operationId: updateNutritionCorrection
      summary: Update a nutrition correction status
      description: Updates the review status of a nutrition correction.
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - status
              properties:
                status:
                  type: string
                  enum:
                    - pending
                    - reviewed
                    - approved
                    - rejected
                reviewNotes:
                  type: string
      responses:
        "200":
          description: Correction updated
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    enum:
                      - true
                  data:
                    type: object
                    properties:
                      correction:
                        type: object
                  message:
                    type: string
                    example: Correction updated
        "400":
          description: Invalid correction ID or status
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "401":
          description: Authentication required
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "404":
          description: Correction not found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
  /api/nutrition/lookup:
    get:
      tags:
        - Nutrition Lookup
      operationId: lookupNutritionByName
      summary: Look up nutrition data by food name
      description: |
        Searches the USDA FoodData Central database for nutrition information matching the given food name and optional brand.
      security:
        - BearerAuth: []
      parameters:
        - name: name
          in: query
          required: true
          schema:
            type: string
          description: Food name to search for
        - name: brand
          in: query
          schema:
            type: string
          description: Optional brand name to narrow results
      responses:
        "200":
          description: Nutrition lookup result
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    enum:
                      - true
                  data:
                    type: object
                    properties:
                      found:
                        type: boolean
                      nutrition:
                        type: object
                        description: Nutrition data from USDA (present when found is true)
        "400":
          description: Missing name parameter
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "401":
          description: Authentication required
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
  /api/nutrition/lookup/{fdcId}:
    get:
      tags:
        - Nutrition Lookup
      operationId: lookupNutritionByFdcId
      summary: Look up nutrition data by USDA FDC ID
      description: |
        Returns detailed nutrition information for a specific food item identified by its USDA FoodData Central ID.
      security:
        - BearerAuth: []
      parameters:
        - name: fdcId
          in: path
          required: true
          schema:
            type: integer
            minimum: 1
      responses:
        "200":
          description: Nutrition data for the given FDC ID
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    enum:
                      - true
                  data:
                    type: object
                    properties:
                      found:
                        type: boolean
                      nutrition:
                        type: object
                        description: Nutrition data from USDA (present when found is true)
        "400":
          description: Invalid fdcId parameter
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "401":
          description: Authentication required
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
  /api/pre-register:
    post:
      operationId: preRegisterEmail
      tags:
        - Pre-Registration
      summary: Pre-register an email from the landing page
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - email
                - privacyConsent
              properties:
                email:
                  type: string
                  format: email
                privacyConsent:
                  type: boolean
      responses:
        "200":
          description: Registration acknowledged
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    nullable: true
                  message:
                    type: string
        "400":
          description: Validation error (missing email, invalid format, or no consent)
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorEnvelope"
  /api/receipt/analyze-receipt:
    post:
      operationId: analyzeReceiptImage
      tags:
        - Receipt Analysis
      summary: Extract food items from a grocery receipt image
      description: |
        Upload a photo of a grocery receipt. The AI reads the receipt, expands abbreviations, extracts food items with prices and UPC codes, and enriches items with USDA nutrition data when barcodes are found.
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              required:
                - image
              properties:
                image:
                  type: string
                  format: binary
                  description: Receipt image file (field name "image" or "file"). Max 20 MB.
      responses:
        "200":
          description: Receipt items extracted.
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: object
                    properties:
                      items:
                        type: array
                        items:
                          $ref: "#/components/schemas/ReceiptItem"
                      storeName:
                        type: string
                        example: Kroger
                      purchaseDate:
                        type: string
                        format: date
                        example: 2025-01-19
                      totalAmount:
                        type: number
                        example: 87.42
                      notes:
                        type: string
                      error:
                        type: string
                        description: Present when no food items are found on the receipt.
        "400":
          description: Invalid request.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
              examples:
                invalidContentType:
                  value:
                    success: false
                    error: Expected multipart/form-data with image file
                    errorCode: INVALID_CONTENT_TYPE
                missingImage:
                  value:
                    success: false
                    error: No image file provided. Please upload an image with field name 'image' or 'file'
                    errorCode: MISSING_IMAGE_FILE
                emptyImage:
                  value:
                    success: false
                    error: The uploaded image file appears to be empty
                    errorCode: EMPTY_IMAGE_FILE
                fileTooLarge:
                  value:
                    success: false
                    error: Image file too large. Maximum size is 20MB
                    errorCode: FILE_TOO_LARGE
                invalidFormat:
                  value:
                    success: false
                    error: Invalid image format.
                    errorCode: INVALID_IMAGE_FORMAT
        "500":
          description: AI parse error.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
              example:
                success: false
                error: Failed to parse AI response
                errorCode: AI_PARSE_ERROR
  /api/receipt/health:
    get:
      operationId: receiptAnalysisHealthCheck
      tags:
        - Receipt Analysis
      summary: Receipt analysis service health check
      security:
        - bearerAuth: []
      responses:
        "200":
          description: Health status.
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: object
                    properties:
                      status:
                        type: string
                        example: ok
                      supportedFormats:
                        type: array
                        items:
                          type: string
                      maxFileSize:
                        type: string
                        example: 20MB
                      model:
                        type: string
                        example: gpt-4o
  /api/recipe-images/upload:
    post:
      operationId: uploadRecipeImage
      tags:
        - Recipe Images
      summary: Upload a recipe image to cloud storage
      description: |
        Uploads a base64-encoded image for a recipe. Returns the display URL and a thumbnail URL from object storage.
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - recipeId
                - base64Data
              properties:
                recipeId:
                  type: string
                  description: Unique identifier for the recipe.
                base64Data:
                  type: string
                  format: byte
                  description: Base64-encoded image data (max ~10 MB payload).
                contentType:
                  type: string
                  default: image/jpeg
                  description: MIME type of the image.
                  example: image/jpeg
      responses:
        "200":
          description: Image uploaded successfully.
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: object
                    properties:
                      cloudImageUri:
                        type: string
                        format: uri
                        description: Full-size image URL.
                      thumbnailUri:
                        type: string
                        format: uri
                        description: Thumbnail image URL.
                      recipeId:
                        type: string
        "400":
          description: Invalid request data.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
              example:
                success: false
                error: Invalid request data
                errorCode: INVALID_REQUEST_DATA
  /api/recipe-images/{recipeId}:
    delete:
      operationId: deleteRecipeImage
      tags:
        - Recipe Images
      summary: Delete a recipe image from cloud storage
      description: Removes the stored image and thumbnail for the given recipe.
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: recipeId
          required: true
          schema:
            type: string
          description: The recipe identifier whose image should be deleted.
      responses:
        "200":
          description: Image deleted.
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: object
                    properties:
                      recipeId:
                        type: string
  /api/recipes/generate:
    post:
      tags:
        - Recipes
      operationId: generateRecipe
      summary: Generate an AI recipe from inventory
      description: |
        Uses AI to generate a recipe based on the user's inventory items, equipment, dietary restrictions, cuisine preferences, and macro targets. Enforces monthly AI recipe generation limits per subscription tier.
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                prioritizeExpiring:
                  type: boolean
                  default: false
                  description: Whether to prioritize soon-to-expire items
                quickRecipe:
                  type: boolean
                  default: false
                  description: Limit total time to 20 minutes
                ingredients:
                  type: array
                  items:
                    oneOf:
                      - type: integer
                      - type: string
                  description: Selected ingredient IDs from inventory
                servings:
                  type: integer
                  minimum: 1
                  maximum: 20
                  default: 4
                maxTime:
                  type: integer
                  minimum: 5
                  maximum: 480
                  default: 60
                  description: Maximum total cooking time in minutes
                dietaryRestrictions:
                  type: string
                cuisine:
                  type: string
                mealType:
                  type: string
                  enum:
                    - breakfast
                    - lunch
                    - dinner
                    - snack
                    - late night snack
                inventory:
                  type: array
                  items:
                    type: object
                    required:
                      - id
                      - name
                    properties:
                      id:
                        oneOf:
                          - type: integer
                          - type: string
                      name:
                        type: string
                      quantity:
                        type: number
                      unit:
                        type: string
                      expiryDate:
                        type: string
                        nullable: true
                equipment:
                  type: array
                  items:
                    type: object
                    required:
                      - id
                      - name
                    properties:
                      id:
                        oneOf:
                          - type: integer
                          - type: string
                      name:
                        type: string
                      alternatives:
                        type: array
                        items:
                          type: string
                macroTargets:
                  type: object
                  properties:
                    protein:
                      type: number
                      minimum: 5
                      maximum: 80
                      default: 50
                    carbs:
                      type: number
                      minimum: 5
                      maximum: 80
                      default: 35
                    fat:
                      type: number
                      minimum: 5
                      maximum: 80
                      default: 15
                previousRecipeTitles:
                  type: array
                  items:
                    type: string
                  description: Previously generated titles for variety
                ingredientCount:
                  type: object
                  properties:
                    min:
                      type: integer
                      minimum: 2
                      maximum: 10
                      default: 4
                    max:
                      type: integer
                      minimum: 2
                      maximum: 10
                      default: 6
      responses:
        "200":
          description: Recipe generated successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    enum:
                      - true
                  data:
                    type: object
                    properties:
                      title:
                        type: string
                      description:
                        type: string
                      ingredients:
                        type: array
                        items:
                          type: object
                          properties:
                            name:
                              type: string
                            quantity:
                              oneOf:
                                - type: number
                                - type: string
                            unit:
                              type: string
                            fromInventory:
                              type: boolean
                      instructions:
                        type: array
                        items:
                          type: string
                      prepTime:
                        type: integer
                      cookTime:
                        type: integer
                      servings:
                        type: integer
                      nutrition:
                        type: object
                        nullable: true
                        properties:
                          calories:
                            type: number
                          protein:
                            type: number
                          carbs:
                            type: number
                          fat:
                            type: number
                      usedExpiringItems:
                        type: array
                        items:
                          type: string
                      usedExpiringCount:
                        type: integer
                      requiredEquipment:
                        type: array
                        items:
                          type: string
                      optionalEquipment:
                        type: array
                        items:
                          type: string
                      substitutionNotes:
                        type: array
                        items:
                          type: string
                      totalExpiringItems:
                        type: integer
                      prioritizedExpiring:
                        type: boolean
                      subscription:
                        type: object
                        properties:
                          aiRecipesRemaining:
                            type: integer
                            nullable: true
                          aiRecipesLimit:
                            type: integer
                            nullable: true
        "400":
          description: Validation error or no ingredients available
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "401":
          description: Authentication required
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "403":
          description: AI recipe limit reached
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
  /api/recipes/generate-image:
    post:
      tags:
        - Recipes
      operationId: generateRecipeImage
      summary: Generate an AI image for a recipe
      description: |
        Uses AI image generation to create a professional food photography image for a recipe based on its title, description, and cuisine.
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - title
              properties:
                title:
                  type: string
                  minLength: 1
                  maxLength: 100
                description:
                  type: string
                  maxLength: 1000
                cuisine:
                  type: string
                  maxLength: 50
      responses:
        "200":
          description: Image generated
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    enum:
                      - true
                  data:
                    type: object
                    properties:
                      imageBase64:
                        type: string
                        description: Base64-encoded display image (WebP)
                      thumbnailBase64:
                        type: string
                        description: Base64-encoded thumbnail (WebP)
                      format:
                        type: string
                        enum:
                          - webp
                      imageUrl:
                        type: string
                        format: uri
                        description: Returned if URL is available instead of base64
        "400":
          description: Validation error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "401":
          description: Authentication required
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
  /api/recipes/scan:
    post:
      tags:
        - Recipes
      operationId: scanRecipeImage
      summary: Scan a recipe from a photo
      description: |
        Uses AI vision to extract a recipe from a photo of a cookbook page, magazine, or printed recipe. Requires the recipeScanning feature access.
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - image
              properties:
                image:
                  type: string
                  description: Base64-encoded image data
      responses:
        "200":
          description: Recipe extracted from image
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    enum:
                      - true
                  data:
                    type: object
                    properties:
                      title:
                        type: string
                      description:
                        type: string
                      ingredients:
                        type: array
                        items:
                          type: string
                      instructions:
                        type: array
                        items:
                          type: string
                      prepTime:
                        type: string
                      cookTime:
                        type: string
                      servings:
                        type: integer
                      notes:
                        type: string
        "400":
          description: Invalid request body or content type
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "401":
          description: Authentication required
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "403":
          description: Feature not available for subscription tier
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
  /api/referral/apply:
    post:
      operationId: applyReferralCode
      tags:
        - Referrals
      summary: Apply a referral code for the authenticated user
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - referralCode
              properties:
                referralCode:
                  type: string
      responses:
        "200":
          description: Referral applied
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  message:
                    type: string
        "400":
          description: Missing code or self-referral
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorEnvelope"
        "401":
          description: Authentication required
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorEnvelope"
        "404":
          description: Invalid referral code
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorEnvelope"
        "409":
          description: Referral already used
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorEnvelope"
  /api/referral/code:
    get:
      operationId: getReferralCode
      tags:
        - Referrals
      summary: Get or generate the user's referral code and share link
      security:
        - BearerAuth: []
      responses:
        "200":
          description: Referral code with stats
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      referralCode:
                        type: string
                      shareLink:
                        type: string
                        format: uri
                      stats:
                        type: object
                        properties:
                          successfulReferrals:
                            type: integer
                          creditsRemaining:
                            type: integer
                          rewardsEarned:
                            type: integer
                          creditsNeededForReward:
                            type: integer
        "401":
          description: Authentication required
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorEnvelope"
        "404":
          description: User not found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorEnvelope"
  /api/referral/validate/{code}:
    get:
      operationId: validateReferralCode
      tags:
        - Referrals
      summary: Validate a referral code (public)
      security: []
      parameters:
        - name: code
          in: path
          required: true
          schema:
            type: string
      responses:
        "200":
          description: Validation result
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      valid:
                        type: boolean
                      referrerName:
                        type: string
                        description: Masked name of the referrer
  /api/stripe/webhook/{uuid}:
    post:
      operationId: handleStripeWebhook
      tags:
        - Stripe Webhooks
      summary: Receive Stripe subscription lifecycle events
      description: |-
        Receives subscription lifecycle events from Stripe. The endpoint is registered before Express body-parsing middleware to receive the raw request body, which is required for HMAC signature verification via `stripe.webhooks.constructEvent()`. The `{uuid}` path segment is a managed webhook identifier assigned during server startup via `stripe-replit-sync`. Stripe sends this URL automatically.

        **Handled event types:** `checkout.session.completed`, `customer.subscription.created`, `customer.subscription.updated`, `customer.subscription.deleted`, `invoice.paid`, `invoice.payment_failed`. Unrecognized event types are silently ignored (200 response).

        **Signature verification:** When `STRIPE_WEBHOOK_SECRET` is configured, the server calls `stripe.webhooks.constructEvent(payload, signature, secret)` for cryptographic verification. When not configured (development mode), the managed webhook proxy handles verification.
      security: []
      parameters:
        - name: uuid
          in: path
          required: true
          schema:
            type: string
            format: uuid
          description: Managed webhook identifier assigned at server startup
        - name: stripe-signature
          in: header
          required: true
          schema:
            type: string
          description: "Stripe HMAC signature for payload verification. Format: `t=<timestamp>,v1=<signature>`. See https://docs.stripe.com/webhooks/signatures"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              description: Raw Stripe event payload. The full event schema is defined by Stripe and varies by event type. See https://docs.stripe.com/api/events
              properties:
                id:
                  type: string
                  description: Unique event identifier (evt_...)
                type:
                  type: string
                  description: Event type (e.g., customer.subscription.updated)
                data:
                  type: object
                  description: Event-specific data object
      responses:
        "200":
          description: Event received and processed (or ignored)
          content:
            application/json:
              schema:
                type: object
                properties:
                  received:
                    type: boolean
                    enum:
                      - true
        "400":
          description: Missing stripe-signature header or invalid payload
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
  /api/subscriptions/apply-retention-offer:
    post:
      operationId: applyRetentionOffer
      tags:
        - Subscriptions
      summary: Apply 50 % off for 3 months retention coupon
      security:
        - BearerAuth: []
      responses:
        "200":
          description: Retention offer applied
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      applied:
                        type: boolean
                      discountPercent:
                        type: integer
                        example: 50
                      durationMonths:
                        type: integer
                        example: 3
        "400":
          description: No active subscription
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorEnvelope"
        "401":
          description: Authentication required
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorEnvelope"
  /api/subscriptions/cancel:
    post:
      operationId: cancelSubscription
      tags:
        - Subscriptions
      summary: Schedule subscription cancellation at period end
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - reason
              properties:
                reason:
                  type: string
                  enum:
                    - too_expensive
                    - not_using
                    - missing_features
                    - other
                details:
                  type: string
                offerShown:
                  type: string
                offerAccepted:
                  type: boolean
      responses:
        "200":
          description: Cancellation scheduled
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      canceled:
                        type: boolean
                      cancelAtPeriodEnd:
                        type: boolean
                      currentPeriodEnd:
                        type: string
                        format: date-time
        "400":
          description: No active subscription or missing reason
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorEnvelope"
        "401":
          description: Authentication required
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorEnvelope"
  /api/subscriptions/check-feature/{feature}:
    get:
      operationId: checkFeatureAccess
      tags:
        - Subscriptions
      summary: Check whether the user has access to a gated feature
      security:
        - BearerAuth: []
      parameters:
        - name: feature
          in: path
          required: true
          schema:
            type: string
            enum:
              - recipeScanning
              - bulkScanning
              - aiKitchenAssistant
              - weeklyMealPrepping
              - customStorageAreas
      responses:
        "200":
          description: Feature access check
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      allowed:
                        type: boolean
                      upgradeRequired:
                        type: boolean
        "400":
          description: Invalid feature name
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorEnvelope"
        "401":
          description: Authentication required
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorEnvelope"
  /api/subscriptions/check-limit/{limitType}:
    get:
      operationId: checkSubscriptionLimit
      tags:
        - Subscriptions
      summary: Check usage limit for a specific resource type
      security:
        - BearerAuth: []
      parameters:
        - name: limitType
          in: path
          required: true
          schema:
            type: string
            enum:
              - pantryItems
              - aiRecipes
              - cookware
      responses:
        "200":
          description: Limit check result
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      limit:
                        type: integer
                      used:
                        type: integer
                      remaining:
                        type: integer
        "400":
          description: Invalid limit type
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorEnvelope"
        "401":
          description: Authentication required
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorEnvelope"
  /api/subscriptions/create-checkout-session:
    post:
      operationId: createCheckoutSession
      tags:
        - Subscriptions
      summary: Create a Stripe Checkout session for a new subscription
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - priceId
              properties:
                priceId:
                  type: string
                successUrl:
                  type: string
                  format: uri
                cancelUrl:
                  type: string
                  format: uri
      responses:
        "200":
          description: Checkout session created
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      sessionId:
                        type: string
                      url:
                        type: string
                        format: uri
        "400":
          description: Platform not supported or missing priceId
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorEnvelope"
        "401":
          description: Authentication required
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorEnvelope"
  /api/subscriptions/create-portal-session:
    post:
      operationId: createPortalSession
      tags:
        - Subscriptions
      summary: Create a Stripe Billing Portal session
      security:
        - BearerAuth: []
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                returnUrl:
                  type: string
                  format: uri
      responses:
        "200":
          description: Portal URL
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      url:
                        type: string
                        format: uri
        "400":
          description: No subscription found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorEnvelope"
        "401":
          description: Authentication required
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorEnvelope"
  /api/subscriptions/log-cancellation-flow:
    post:
      operationId: logCancellationFlow
      tags:
        - Subscriptions
      summary: Log cancellation flow interaction (analytics)
      security:
        - BearerAuth: []
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                reason:
                  type: string
                  enum:
                    - too_expensive
                    - not_using
                    - missing_features
                    - other
                details:
                  type: string
                offerShown:
                  type: string
                offerAccepted:
                  type: boolean
      responses:
        "200":
          description: Interaction logged
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      logged:
                        type: boolean
        "401":
          description: Authentication required
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorEnvelope"
  /api/subscriptions/me:
    get:
      operationId: getMyEntitlements
      tags:
        - Subscriptions
      summary: Get full entitlements, usage, limits, and grace-period info
      security:
        - BearerAuth: []
      responses:
        "200":
          description: Entitlements with usage
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      tier:
                        type: string
                      status:
                        type: string
                      planType:
                        type: string
                        nullable: true
                      entitlements:
                        type: object
                      usage:
                        type: object
                      remaining:
                        type: object
                      trialEndsAt:
                        type: string
                        format: date-time
                        nullable: true
                      currentPeriodEnd:
                        type: string
                        format: date-time
                        nullable: true
                      cancelAtPeriodEnd:
                        type: boolean
                      paymentFailedAt:
                        type: string
                        format: date-time
                        nullable: true
                      gracePeriodEnd:
                        type: string
                        format: date-time
                        nullable: true
                      graceDaysRemaining:
                        type: integer
                        nullable: true
        "401":
          description: Authentication required
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorEnvelope"
  /api/subscriptions/pause:
    post:
      operationId: pauseSubscription
      tags:
        - Subscriptions
      summary: Pause subscription for 1-3 months
      security:
        - BearerAuth: []
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                durationMonths:
                  type: integer
                  enum:
                    - 1
                    - 2
                    - 3
                  default: 1
      responses:
        "200":
          description: Subscription paused
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      paused:
                        type: boolean
                      resumesAt:
                        type: string
                        format: date-time
                      durationMonths:
                        type: integer
        "400":
          description: No active subscription or invalid duration
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorEnvelope"
        "401":
          description: Authentication required
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorEnvelope"
  /api/subscriptions/preview-proration:
    post:
      operationId: previewProration
      tags:
        - Subscriptions
      summary: Preview proration amounts before plan change
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - newPriceId
              properties:
                newPriceId:
                  type: string
      responses:
        "200":
          description: Proration preview
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      proratedAmount:
                        type: integer
                      creditAmount:
                        type: integer
                      newAmount:
                        type: integer
                      currency:
                        type: string
                      immediatePayment:
                        type: integer
        "400":
          description: No active subscription or invalid price
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorEnvelope"
        "401":
          description: Authentication required
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorEnvelope"
  /api/subscriptions/prices:
    get:
      operationId: getSubscriptionPrices
      tags:
        - Subscriptions
      summary: List active recurring Stripe prices (cached)
      security: []
      responses:
        "200":
          description: Tiered price info
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      proMonthly:
                        $ref: "#/components/schemas/PriceInfo"
                      proAnnual:
                        $ref: "#/components/schemas/PriceInfo"
                      monthly:
                        $ref: "#/components/schemas/PriceInfo"
                      annual:
                        $ref: "#/components/schemas/PriceInfo"
  /api/subscriptions/publishable-key:
    get:
      operationId: getStripePublishableKey
      tags:
        - Subscriptions
      summary: Return Stripe publishable key for client-side SDK
      security: []
      responses:
        "200":
          description: Publishable key
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      publishableKey:
                        type: string
  /api/subscriptions/session/{sessionId}:
    get:
      operationId: getCheckoutSession
      tags:
        - Subscriptions
      summary: Retrieve a completed Checkout session's details
      security: []
      parameters:
        - name: sessionId
          in: path
          required: true
          schema:
            type: string
      responses:
        "200":
          description: Session details
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      customerEmail:
                        type: string
                        nullable: true
                      subscriptionId:
                        type: string
                        nullable: true
                      planType:
                        type: string
                        enum:
                          - monthly
                          - annual
                      trialEnd:
                        type: string
                        format: date-time
                        nullable: true
                      amount:
                        type: integer
                      currency:
                        type: string
        "400":
          description: Missing session ID
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorEnvelope"
        "404":
          description: Session not found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorEnvelope"
  /api/subscriptions/status:
    get:
      operationId: getSubscriptionStatus
      tags:
        - Subscriptions
      summary: Get current user's Stripe subscription status
      security:
        - BearerAuth: []
      responses:
        "200":
          description: Subscription status
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      status:
                        type: string
                      planType:
                        type: string
                        nullable: true
                      currentPeriodStart:
                        type: string
                        format: date-time
                        nullable: true
                      currentPeriodEnd:
                        type: string
                        format: date-time
                        nullable: true
                      trialStart:
                        type: string
                        format: date-time
                        nullable: true
                      trialEnd:
                        type: string
                        format: date-time
                        nullable: true
                      cancelAtPeriodEnd:
                        type: boolean
                      canceledAt:
                        type: string
                        format: date-time
                        nullable: true
        "401":
          description: Authentication required
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorEnvelope"
  /api/subscriptions/sync-revenuecat:
    post:
      operationId: syncRevenueCatPurchase
      tags:
        - Subscriptions
      summary: Sync RevenueCat in-app purchase status to server
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - tier
                - status
              properties:
                tier:
                  type: string
                  enum:
                    - PRO
                status:
                  type: string
                  enum:
                    - active
                    - trialing
                    - canceled
                    - expired
                    - past_due
                expirationDate:
                  type: string
                  format: date-time
      responses:
        "200":
          description: Sync successful
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      tier:
                        type: string
                      status:
                        type: string
        "400":
          description: Missing or invalid fields
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorEnvelope"
        "401":
          description: Authentication required
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorEnvelope"
  /api/subscriptions/upgrade:
    post:
      operationId: upgradeSubscription
      tags:
        - Subscriptions
      summary: Upgrade or change subscription plan (in-place or new checkout)
      security:
        - BearerAuth: []
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                billingPeriod:
                  type: string
                  enum:
                    - monthly
                    - annual
                  default: monthly
                priceId:
                  type: string
                successUrl:
                  type: string
                  format: uri
                cancelUrl:
                  type: string
                  format: uri
      responses:
        "200":
          description: Upgrade result – either in-place or checkout URL
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    oneOf:
                      - type: object
                        properties:
                          upgraded:
                            type: boolean
                          tier:
                            type: string
                          planType:
                            type: string
                          status:
                            type: string
                      - type: object
                        properties:
                          sessionId:
                            type: string
                          url:
                            type: string
                            format: uri
        "400":
          description: Platform not supported or invalid price
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorEnvelope"
        "401":
          description: Authentication required
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorEnvelope"
  /api/suggestions/fun-fact:
    post:
      operationId: getInventoryFunFact
      tags:
        - Suggestions
      summary: AI-generated fun fact about the user's inventory
      description: |
        Returns a short, fun, educational fact about the foods currently in the user's inventory. Results are cached for 24 hours per unique item set.
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                items:
                  type: array
                  items:
                    type: object
                    properties:
                      name:
                        type: string
                nutritionTotals:
                  type: object
                  properties:
                    calories:
                      type: number
                    protein:
                      type: number
                    carbs:
                      type: number
                    fat:
                      type: number
                    itemsWithNutrition:
                      type: integer
      responses:
        "200":
          description: Fun fact returned.
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: object
                    properties:
                      fact:
                        type: string
                        example: Your eggs could make 3 perfect French omelets!
  /api/suggestions/shelf-life:
    post:
      operationId: estimateShelfLife
      tags:
        - Shelf Life
        - Suggestions
      summary: Shelf-life estimation with local database + AI fallback
      description: |
        Estimates the shelf life for a given food item. Two handlers serve this path: the suggestions router (requires both foodName and storageLocation) and the dedicated shelf-life router (requires foodName, storageLocation defaults to "refrigerator"). Both return the same response shape. The dedicated handler first checks a local database of known foods, then falls back to AI estimation.
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - foodName
              properties:
                foodName:
                  type: string
                  description: Name of the food item.
                  example: cheddar cheese
                category:
                  type: string
                  description: Optional food category for improved matching.
                  example: dairy
                storageLocation:
                  type: string
                  description: Where the item is stored. Defaults to "refrigerator".
                  enum:
                    - refrigerator
                    - fridge
                    - freezer
                    - pantry
                    - counter
                  example: refrigerator
      responses:
        "200":
          description: Shelf-life estimation returned.
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    $ref: "#/components/schemas/ShelfLifeResult"
        "400":
          description: Validation error or missing required fields.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
              examples:
                validationError:
                  value:
                    success: false
                    error: "Invalid input: Food name is required"
                    errorCode: VALIDATION_ERROR
                missingFields:
                  value:
                    success: false
                    error: foodName and storageLocation are required
                    errorCode: MISSING_REQUIRED_FIELDS
  /api/suggestions/waste-reduction:
    post:
      operationId: getWasteReductionTips
      tags:
        - Suggestions
      summary: AI waste-reduction tips for expiring items
      description: |
        Given a list of food items that are expiring soon, returns 3-5 actionable tips (recipe ideas, storage advice, freezing recommendations) to reduce food waste.
      security:
        - bearerAuth: []
      parameters:
        - in: query
          name: refresh
          schema:
            type: string
            enum:
              - "true"
              - "false"
          description: Set to "true" to bypass the server-side cache.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                expiringItems:
                  type: array
                  items:
                    type: object
                    properties:
                      id:
                        type: integer
                      name:
                        type: string
                      daysUntilExpiry:
                        type: integer
                      quantity:
                        type: integer
      responses:
        "200":
          description: Waste-reduction suggestions returned.
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: object
                    properties:
                      suggestions:
                        type: array
                        items:
                          type: object
                          properties:
                            text:
                              type: string
                            category:
                              type: string
                              enum:
                                - recipe
                                - storage
                                - freeze
                                - preserve
                                - general
                            searchQuery:
                              type: string
                              description: Present only for "recipe" category tips.
                      expiringItems:
                        type: array
                        items:
                          type: object
                          properties:
                            id:
                              type: integer
                            name:
                              type: string
                            daysUntilExpiry:
                              type: integer
                            quantity:
                              type: integer
  /api/sync/cookware:
    post:
      tags:
        - Sync - Cookware
      operationId: syncCookwareItem
      summary: Create, update, or delete a cookware item via sync
      description: |
        Performs a sync operation on a single cookware item. Create uses upsert semantics and checks cookware limits. Update checks timestamps for conflict resolution. Enforces cookware item limits per subscription.
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - operation
                - data
              properties:
                operation:
                  type: string
                  enum:
                    - create
                    - update
                    - delete
                data:
                  $ref: "#/components/schemas/SyncCookwareInput"
                clientTimestamp:
                  type: string
                  format: date-time
      responses:
        "200":
          description: Sync operation completed
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    enum:
                      - true
                  data:
                    type: object
                    properties:
                      syncedAt:
                        type: string
                        format: date-time
                      operation:
                        type: string
                        enum:
                          - create
                          - update
                          - delete
                          - skipped
                      itemId:
                        type: string
                      reason:
                        type: string
                      serverVersion:
                        $ref: "#/components/schemas/SyncCookwareItem"
        "400":
          description: Invalid request data
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "401":
          description: Unauthorized or session expired
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "403":
          description: Cookware item limit reached
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
    put:
      tags:
        - Sync - Cookware
      operationId: updateSyncCookwareItem
      summary: Update a cookware item with conflict resolution
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - data
              properties:
                data:
                  $ref: "#/components/schemas/SyncCookwareInput"
                clientTimestamp:
                  type: string
                  format: date-time
      responses:
        "200":
          description: Update completed or skipped
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    enum:
                      - true
                  data:
                    type: object
                    properties:
                      syncedAt:
                        type: string
                        format: date-time
                      operation:
                        type: string
                        enum:
                          - update
                          - skipped
                      itemId:
                        type: string
                      reason:
                        type: string
                      serverVersion:
                        $ref: "#/components/schemas/SyncCookwareItem"
        "400":
          description: Invalid request data
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "401":
          description: Unauthorized or session expired
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "403":
          description: Cookware item limit reached
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
    delete:
      tags:
        - Sync - Cookware
      operationId: deleteSyncCookwareItem
      summary: Delete a cookware item
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - data
              properties:
                data:
                  type: object
                  required:
                    - id
                  properties:
                    id:
                      oneOf:
                        - type: string
                        - type: integer
      responses:
        "200":
          description: Cookware item deleted
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    enum:
                      - true
                  data:
                    type: object
                    properties:
                      syncedAt:
                        type: string
                        format: date-time
                      operation:
                        type: string
                        enum:
                          - delete
                      itemId:
                        type: string
        "400":
          description: Invalid request data
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "401":
          description: Unauthorized or session expired
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
  /api/sync/export:
    post:
      tags:
        - Sync
      operationId: exportUserData
      summary: Export all user data as JSON backup
      description: |
        Exports all user data (inventory, recipes, meal plans, shopping list, cookware, waste logs, consumed logs, preferences, analytics, onboarding, custom locations, user profile) as a downloadable JSON file.
      security:
        - BearerAuth: []
      responses:
        "200":
          description: Data export returned as JSON attachment
          headers:
            Content-Disposition:
              schema:
                type: string
                example: attachment; filename="chefspaice-backup-2026-02-12.json"
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    enum:
                      - true
                  data:
                    type: object
                    properties:
                      version:
                        type: integer
                        enum:
                          - 1
                      exportedAt:
                        type: string
                        format: date-time
                      data:
                        type: object
                        properties:
                          inventory:
                            type: array
                            items:
                              $ref: "#/components/schemas/InventoryItemExport"
                          recipes:
                            type: array
                            items:
                              $ref: "#/components/schemas/RecipeExport"
                          mealPlans:
                            type: array
                            items:
                              $ref: "#/components/schemas/MealPlanExport"
                          shoppingList:
                            type: array
                            items:
                              $ref: "#/components/schemas/ShoppingItemExport"
                          cookware:
                            type: array
                            items:
                              $ref: "#/components/schemas/CookwareExport"
                          preferences:
                            type: object
                            nullable: true
                          wasteLog:
                            type: array
                            items:
                              type: object
                              properties:
                                id:
                                  type: string
                                itemName:
                                  type: string
                                quantity:
                                  type: number
                                unit:
                                  type: string
                                reason:
                                  type: string
                                date:
                                  type: string
                          consumedLog:
                            type: array
                            items:
                              type: object
                              properties:
                                id:
                                  type: string
                                itemName:
                                  type: string
                                quantity:
                                  type: number
                                unit:
                                  type: string
                                date:
                                  type: string
                          analytics:
                            type: object
                            nullable: true
                          onboarding:
                            type: object
                            nullable: true
                          customLocations:
                            type: array
                            items:
                              type: object
                              properties:
                                id:
                                  type: string
                                name:
                                  type: string
                                type:
                                  type: string
                          userProfile:
                            type: object
                            nullable: true
        "401":
          description: Unauthorized or session expired
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
  /api/sync/import:
    post:
      tags:
        - Sync
      operationId: importUserData
      summary: Import user data from a JSON backup
      description: |
        Imports user data from a previously exported backup. Supports two modes: "merge" (upsert items, keeping existing data) and "replace" (delete all existing data before importing). Validates all items against sync schemas and enforces subscription limits on inventory and cookware counts.
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - backup
                - mode
              properties:
                backup:
                  type: object
                  required:
                    - version
                    - exportedAt
                    - data
                  properties:
                    version:
                      type: integer
                      enum:
                        - 1
                    exportedAt:
                      type: string
                      format: date-time
                    data:
                      type: object
                      additionalProperties: true
                mode:
                  type: string
                  enum:
                    - merge
                    - replace
                  description: "'merge' upserts items; 'replace' deletes existing data first"
      responses:
        "200":
          description: Import completed
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    enum:
                      - true
                  data:
                    type: object
                    properties:
                      importedAt:
                        type: string
                        format: date-time
                      mode:
                        type: string
                      counts:
                        type: object
                        properties:
                          inventory:
                            type: integer
                          recipes:
                            type: integer
                          mealPlans:
                            type: integer
                          shoppingList:
                            type: integer
                          cookware:
                            type: integer
                      truncationWarnings:
                        type: array
                        items:
                          type: string
        "400":
          description: Invalid backup format or validation errors
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "401":
          description: Unauthorized or session expired
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
  /api/sync/inventory:
    get:
      tags:
        - Sync - Inventory
      operationId: listSyncInventory
      summary: List inventory items (paginated)
      description: |
        Returns inventory items for the authenticated user with cursor-based pagination. Items are ordered by updatedAt ascending. Soft-deleted items (deletedAt not null) are excluded.
      security:
        - BearerAuth: []
      parameters:
        - name: limit
          in: query
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 50
          description: Number of items per page
        - name: cursor
          in: query
          schema:
            type: string
          description: Base64url-encoded cursor for pagination
      responses:
        "200":
          description: Paginated inventory items
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    enum:
                      - true
                  data:
                    type: object
                    properties:
                      items:
                        type: array
                        items:
                          $ref: "#/components/schemas/SyncInventoryItem"
                      nextCursor:
                        type: string
                        nullable: true
                        description: Cursor for next page; null if no more items
        "400":
          description: Invalid cursor
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "401":
          description: Unauthorized or session expired
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
    post:
      tags:
        - Sync - Inventory
      operationId: syncInventoryItem
      summary: Create, update, or delete an inventory item via sync
      description: |
        Performs a sync operation (create, update, or delete) on a single inventory item. Create uses upsert semantics. Update checks timestamps for conflict resolution—if the incoming timestamp is stale, the server version is returned with operation "skipped". Enforces pantry item limits.
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - operation
                - data
              properties:
                operation:
                  type: string
                  enum:
                    - create
                    - update
                    - delete
                data:
                  $ref: "#/components/schemas/SyncInventoryItemInput"
                clientTimestamp:
                  type: string
                  format: date-time
      responses:
        "200":
          description: Sync operation completed
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    enum:
                      - true
                  data:
                    type: object
                    properties:
                      syncedAt:
                        type: string
                        format: date-time
                      operation:
                        type: string
                        enum:
                          - create
                          - update
                          - delete
                          - skipped
                      itemId:
                        type: string
                      reason:
                        type: string
                        description: Present when operation is "skipped"
                      serverVersion:
                        $ref: "#/components/schemas/SyncInventoryItem"
        "400":
          description: Invalid request data
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "401":
          description: Unauthorized or session expired
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "403":
          description: Pantry item limit reached
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
    put:
      tags:
        - Sync - Inventory
      operationId: updateSyncInventoryItem
      summary: Update an inventory item with conflict resolution
      description: |
        Updates an existing inventory item or creates it if not found. Uses timestamp-based conflict resolution—stale updates are skipped and the server version is returned. Enforces pantry item limits when creating.
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - data
              properties:
                data:
                  $ref: "#/components/schemas/SyncInventoryItemInput"
                clientTimestamp:
                  type: string
                  format: date-time
      responses:
        "200":
          description: Update completed or skipped
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    enum:
                      - true
                  data:
                    type: object
                    properties:
                      syncedAt:
                        type: string
                        format: date-time
                      operation:
                        type: string
                        enum:
                          - update
                          - skipped
                      itemId:
                        type: string
                      reason:
                        type: string
                      serverVersion:
                        $ref: "#/components/schemas/SyncInventoryItem"
        "400":
          description: Invalid request data
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "401":
          description: Unauthorized or session expired
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "403":
          description: Pantry item limit reached
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
    delete:
      tags:
        - Sync - Inventory
      operationId: deleteSyncInventoryItem
      summary: Delete an inventory item
      description: Permanently deletes an inventory item by its ID.
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - data
              properties:
                data:
                  type: object
                  required:
                    - id
                  properties:
                    id:
                      oneOf:
                        - type: string
                        - type: integer
      responses:
        "200":
          description: Item deleted
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    enum:
                      - true
                  data:
                    type: object
                    properties:
                      syncedAt:
                        type: string
                        format: date-time
                      operation:
                        type: string
                        enum:
                          - delete
                      itemId:
                        type: string
        "400":
          description: Invalid request data
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "401":
          description: Unauthorized or session expired
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
  /api/sync/mealPlans:
    post:
      tags:
        - Sync - Meal Plans
      operationId: syncMealPlan
      summary: Create, update, or delete a meal plan via sync
      description: |
        Performs a sync operation on a single meal plan entry. Create uses upsert semantics. Update checks timestamps for conflict resolution. Note: meal plans do not have a GET (paginated) endpoint at this level.
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - operation
                - data
              properties:
                operation:
                  type: string
                  enum:
                    - create
                    - update
                    - delete
                data:
                  $ref: "#/components/schemas/SyncMealPlanInput"
                clientTimestamp:
                  type: string
                  format: date-time
      responses:
        "200":
          description: Sync operation completed
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    enum:
                      - true
                  data:
                    type: object
                    properties:
                      syncedAt:
                        type: string
                        format: date-time
                      operation:
                        type: string
                        enum:
                          - create
                          - update
                          - delete
                          - skipped
                      itemId:
                        type: string
                      reason:
                        type: string
                      serverVersion:
                        $ref: "#/components/schemas/SyncMealPlan"
        "400":
          description: Invalid request data
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "401":
          description: Unauthorized or session expired
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
    put:
      tags:
        - Sync - Meal Plans
      operationId: updateSyncMealPlan
      summary: Update a meal plan with conflict resolution
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - data
              properties:
                data:
                  $ref: "#/components/schemas/SyncMealPlanInput"
                clientTimestamp:
                  type: string
                  format: date-time
      responses:
        "200":
          description: Update completed or skipped
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    enum:
                      - true
                  data:
                    type: object
                    properties:
                      syncedAt:
                        type: string
                        format: date-time
                      operation:
                        type: string
                        enum:
                          - update
                          - skipped
                      itemId:
                        type: string
                      reason:
                        type: string
                      serverVersion:
                        $ref: "#/components/schemas/SyncMealPlan"
        "400":
          description: Invalid request data
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "401":
          description: Unauthorized or session expired
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
    delete:
      tags:
        - Sync - Meal Plans
      operationId: deleteSyncMealPlan
      summary: Delete a meal plan
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - data
              properties:
                data:
                  type: object
                  required:
                    - id
                  properties:
                    id:
                      oneOf:
                        - type: string
                        - type: integer
      responses:
        "200":
          description: Meal plan deleted
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    enum:
                      - true
                  data:
                    type: object
                    properties:
                      syncedAt:
                        type: string
                        format: date-time
                      operation:
                        type: string
                        enum:
                          - delete
                      itemId:
                        type: string
        "400":
          description: Invalid request data
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "401":
          description: Unauthorized or session expired
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
  /api/sync/recipes:
    get:
      tags:
        - Sync - Recipes
      operationId: listSyncRecipes
      summary: List saved recipes (paginated)
      description: |
        Returns saved recipes for the authenticated user with cursor-based pagination. Items are ordered by updatedAt ascending.
      security:
        - BearerAuth: []
      parameters:
        - name: limit
          in: query
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 50
        - name: cursor
          in: query
          schema:
            type: string
      responses:
        "200":
          description: Paginated recipes
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    enum:
                      - true
                  data:
                    type: object
                    properties:
                      items:
                        type: array
                        items:
                          $ref: "#/components/schemas/SyncRecipe"
                      nextCursor:
                        type: string
                        nullable: true
        "400":
          description: Invalid cursor
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "401":
          description: Unauthorized or session expired
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
    post:
      tags:
        - Sync - Recipes
      operationId: syncRecipe
      summary: Create, update, or delete a recipe via sync
      description: |
        Performs a sync operation on a single recipe. Create uses upsert semantics. Update checks timestamps for conflict resolution.
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - operation
                - data
              properties:
                operation:
                  type: string
                  enum:
                    - create
                    - update
                    - delete
                data:
                  $ref: "#/components/schemas/SyncRecipeInput"
                clientTimestamp:
                  type: string
                  format: date-time
      responses:
        "200":
          description: Sync operation completed
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    enum:
                      - true
                  data:
                    type: object
                    properties:
                      syncedAt:
                        type: string
                        format: date-time
                      operation:
                        type: string
                        enum:
                          - create
                          - update
                          - delete
                          - skipped
                      itemId:
                        type: string
                      reason:
                        type: string
                      serverVersion:
                        $ref: "#/components/schemas/SyncRecipe"
        "400":
          description: Invalid request data
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "401":
          description: Unauthorized or session expired
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
    put:
      tags:
        - Sync - Recipes
      operationId: updateSyncRecipe
      summary: Update a recipe with conflict resolution
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - data
              properties:
                data:
                  $ref: "#/components/schemas/SyncRecipeInput"
                clientTimestamp:
                  type: string
                  format: date-time
      responses:
        "200":
          description: Update completed or skipped
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    enum:
                      - true
                  data:
                    type: object
                    properties:
                      syncedAt:
                        type: string
                        format: date-time
                      operation:
                        type: string
                        enum:
                          - update
                          - skipped
                      itemId:
                        type: string
                      reason:
                        type: string
                      serverVersion:
                        $ref: "#/components/schemas/SyncRecipe"
        "400":
          description: Invalid request data
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "401":
          description: Unauthorized or session expired
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
    delete:
      tags:
        - Sync - Recipes
      operationId: deleteSyncRecipe
      summary: Delete a recipe
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - data
              properties:
                data:
                  type: object
                  required:
                    - id
                  properties:
                    id:
                      oneOf:
                        - type: string
                        - type: integer
      responses:
        "200":
          description: Recipe deleted
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    enum:
                      - true
                  data:
                    type: object
                    properties:
                      syncedAt:
                        type: string
                        format: date-time
                      operation:
                        type: string
                        enum:
                          - delete
                      itemId:
                        type: string
        "400":
          description: Invalid request data
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "401":
          description: Unauthorized or session expired
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
  /api/sync/shoppingList:
    get:
      tags:
        - Sync - Shopping List
      operationId: listSyncShoppingList
      summary: List shopping list items (paginated)
      description: |
        Returns shopping list items for the authenticated user with cursor-based pagination ordered by updatedAt ascending.
      security:
        - BearerAuth: []
      parameters:
        - name: limit
          in: query
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 50
        - name: cursor
          in: query
          schema:
            type: string
      responses:
        "200":
          description: Paginated shopping list items
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    enum:
                      - true
                  data:
                    type: object
                    properties:
                      items:
                        type: array
                        items:
                          $ref: "#/components/schemas/SyncShoppingItem"
                      nextCursor:
                        type: string
                        nullable: true
        "400":
          description: Invalid cursor
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "401":
          description: Unauthorized or session expired
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
    post:
      tags:
        - Sync - Shopping List
      operationId: syncShoppingItem
      summary: Create, update, or delete a shopping list item via sync
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - operation
                - data
              properties:
                operation:
                  type: string
                  enum:
                    - create
                    - update
                    - delete
                data:
                  $ref: "#/components/schemas/SyncShoppingItemInput"
                clientTimestamp:
                  type: string
                  format: date-time
      responses:
        "200":
          description: Sync operation completed
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    enum:
                      - true
                  data:
                    type: object
                    properties:
                      syncedAt:
                        type: string
                        format: date-time
                      operation:
                        type: string
                        enum:
                          - create
                          - update
                          - delete
                          - skipped
                      itemId:
                        type: string
                      reason:
                        type: string
                      serverVersion:
                        $ref: "#/components/schemas/SyncShoppingItem"
        "400":
          description: Invalid request data
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "401":
          description: Unauthorized or session expired
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
    put:
      tags:
        - Sync - Shopping List
      operationId: updateSyncShoppingItem
      summary: Update a shopping list item with conflict resolution
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - data
              properties:
                data:
                  $ref: "#/components/schemas/SyncShoppingItemInput"
                clientTimestamp:
                  type: string
                  format: date-time
      responses:
        "200":
          description: Update completed or skipped
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    enum:
                      - true
                  data:
                    type: object
                    properties:
                      syncedAt:
                        type: string
                        format: date-time
                      operation:
                        type: string
                        enum:
                          - update
                          - skipped
                      itemId:
                        type: string
                      reason:
                        type: string
                      serverVersion:
                        $ref: "#/components/schemas/SyncShoppingItem"
        "400":
          description: Invalid request data
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "401":
          description: Unauthorized or session expired
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
    delete:
      tags:
        - Sync - Shopping List
      operationId: deleteSyncShoppingItem
      summary: Delete a shopping list item
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - data
              properties:
                data:
                  type: object
                  required:
                    - id
                  properties:
                    id:
                      oneOf:
                        - type: string
                        - type: integer
      responses:
        "200":
          description: Item deleted
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    enum:
                      - true
                  data:
                    type: object
                    properties:
                      syncedAt:
                        type: string
                        format: date-time
                      operation:
                        type: string
                        enum:
                          - delete
                      itemId:
                        type: string
        "400":
          description: Invalid request data
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "401":
          description: Unauthorized or session expired
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
  /api/sync/status:
    get:
      tags:
        - Sync
      operationId: getSyncStatus
      summary: Get sync status and data counts
      description: |
        Returns the current sync status for the authenticated user, including last sync timestamp, recent failure records (last 24 hours), data consistency flag, and item counts per data type.
      security:
        - BearerAuth: []
      responses:
        "200":
          description: Sync status retrieved
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    enum:
                      - true
                  data:
                    type: object
                    properties:
                      lastSyncedAt:
                        type: string
                        format: date-time
                        nullable: true
                      failedOperations24h:
                        type: integer
                      recentFailures:
                        type: array
                        items:
                          type: object
                          properties:
                            dataType:
                              type: string
                            operation:
                              type: string
                            errorMessage:
                              type: string
                            timestamp:
                              type: string
                              format: date-time
                      isConsistent:
                        type: boolean
                      dataTypes:
                        type: object
                        properties:
                          inventory:
                            type: integer
                          recipes:
                            type: integer
                          mealPlans:
                            type: integer
                          shoppingList:
                            type: integer
                          cookware:
                            type: integer
        "401":
          description: Unauthorized or session expired
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
  /api/user/appliances:
    get:
      tags:
        - User Appliances
      operationId: listUserAppliances
      summary: List user's kitchen appliances
      description: Returns all appliances the authenticated user has added to their kitchen.
      security:
        - BearerAuth: []
      responses:
        "200":
          description: User's appliances
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    enum:
                      - true
                  data:
                    type: array
                    items:
                      $ref: "#/components/schemas/UserAppliance"
        "401":
          description: Authentication required
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
    post:
      tags:
        - User Appliances
      operationId: addUserAppliance
      summary: Add an appliance to user's kitchen
      description: Adds a catalog appliance to the user's kitchen by appliance ID.
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - applianceId
              properties:
                applianceId:
                  type: integer
                notes:
                  type: string
                brand:
                  type: string
      responses:
        "201":
          description: Appliance added
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    enum:
                      - true
                  data:
                    $ref: "#/components/schemas/UserAppliance"
        "400":
          description: Missing appliance ID
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "401":
          description: Authentication required
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "404":
          description: Appliance not found in catalog
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "409":
          description: Appliance already in user's kitchen
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
  /api/user/appliances/bulk:
    post:
      tags:
        - User Appliances
      operationId: bulkSyncUserAppliances
      summary: Bulk sync user's appliances
      description: |
        Replaces the user's appliance set with the provided list of appliance IDs. Adds new IDs and removes IDs no longer in the list.
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - applianceIds
              properties:
                applianceIds:
                  type: array
                  items:
                    type: integer
                  description: Full list of appliance IDs the user should have
      responses:
        "200":
          description: Bulk sync completed
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    enum:
                      - true
                  data:
                    type: object
                    properties:
                      added:
                        type: integer
                      removed:
                        type: integer
                      total:
                        type: integer
                  message:
                    type: string
        "400":
          description: Invalid appliance IDs
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "401":
          description: Authentication required
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
  /api/user/appliances/{applianceId}:
    delete:
      tags:
        - User Appliances
      operationId: removeUserAppliance
      summary: Remove an appliance from user's kitchen
      security:
        - BearerAuth: []
      parameters:
        - name: applianceId
          in: path
          required: true
          schema:
            type: integer
      responses:
        "200":
          description: Appliance removed
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    enum:
                      - true
                  data:
                    nullable: true
                  message:
                    type: string
                    example: Appliance removed from kitchen
        "400":
          description: Invalid appliance ID
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "401":
          description: Authentication required
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "404":
          description: Appliance not found in user's kitchen
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
  /api/user/export-data:
    get:
      tags:
        - Account
      operationId: exportUserData
      summary: Export all user data (GDPR)
      description: |
        Exports all data associated with the authenticated user as a JSON file download. Compliant with GDPR Article 20 (Right to Data Portability). Includes profile, auth providers, sessions, subscription, sync data, inventory, recipes, meal plans, shopping list, cookware, waste log, consumed log, custom locations, preferences, referrals, cancellation reasons, conversion events, feedback, nutrition corrections, appliances, notifications, and password reset token metadata.
      security:
        - BearerAuth: []
      responses:
        "200":
          description: User data export (JSON file download)
          headers:
            Content-Disposition:
              schema:
                type: string
                example: attachment; filename="chefspaice-data-<userId>.json"
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    enum:
                      - true
                  data:
                    type: object
                    properties:
                      exportDate:
                        type: string
                        format: date-time
                      dataSubject:
                        type: string
                        example: GDPR Article 20 - Right to Data Portability
                      profile:
                        type: object
                        description: Full user profile data
                      authProviders:
                        type: array
                        items:
                          type: object
                      sessions:
                        type: array
                        items:
                          type: object
                      subscription:
                        type: object
                        nullable: true
                      syncData:
                        type: object
                      inventory:
                        type: array
                        items:
                          type: object
                      recipes:
                        type: array
                        items:
                          type: object
                      mealPlans:
                        type: array
                        items:
                          type: object
                      shoppingList:
                        type: array
                        items:
                          type: object
                      cookware:
                        type: array
                        items:
                          type: object
                      wasteLog:
                        type: array
                        items:
                          type: object
                      consumedLog:
                        type: array
                        items:
                          type: object
                      customLocations:
                        type: array
                        items:
                          type: object
                      preferences:
                        type: object
                        nullable: true
                      analytics:
                        type: object
                        nullable: true
                      onboarding:
                        type: object
                        nullable: true
                      userProfile:
                        type: object
                        nullable: true
                      referrals:
                        type: array
                        items:
                          type: object
                      cancellationReasons:
                        type: array
                        items:
                          type: object
                      conversionEvents:
                        type: array
                        items:
                          type: object
                      feedback:
                        type: array
                        items:
                          type: object
                      nutritionCorrections:
                        type: array
                        items:
                          type: object
                      userAppliances:
                        type: array
                        items:
                          type: object
                      notifications:
                        type: array
                        items:
                          type: object
                      passwordResetTokens:
                        type: array
                        items:
                          type: object
        "401":
          description: Not authenticated
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "404":
          description: User not found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
  /api/user/push-token:
    post:
      operationId: registerPushToken
      tags:
        - Notifications
      summary: "[DEPRECATED] Register push notification token"
      deprecated: true
      description: |
        **Deprecated since v1.0.0.** Use `POST /api/notifications/register-device` instead. Registers or updates an Expo push notification token for the authenticated user. Validates token format using the Expo SDK. If the token already exists, updates the associated user and platform.
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - token
              properties:
                token:
                  type: string
                  description: Expo push notification token
                platform:
                  type: string
                  description: Device platform (defaults to "unknown" if omitted)
      responses:
        "200":
          description: Token registered
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      registered:
                        type: boolean
                        enum:
                          - true
        "400":
          description: Invalid Expo push token format
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorEnvelope"
        "401":
          description: Authentication required
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorEnvelope"
    delete:
      operationId: removePushToken
      tags:
        - Notifications
      summary: "[DEPRECATED] Remove push notification token(s)"
      deprecated: true
      description: |
        **Deprecated since v1.0.0.** Use `POST /api/notifications/register-device` for token management. Removes a specific push token or all tokens for the authenticated user. If `token` is provided in the request body, only that token is removed; otherwise all tokens for the user are removed.
      security:
        - BearerAuth: []
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                token:
                  type: string
                  description: Specific token to remove (omit to remove all)
      responses:
        "200":
          description: Token(s) removed
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      removed:
                        type: boolean
                        enum:
                          - true
        "401":
          description: Authentication required
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorEnvelope"
  /api/version-check:
    get:
      operationId: getVersionCheck
      tags:
        - Version Check
      summary: Check app version for OTA update decisions
      description: |
        Returns whether the client's current version requires a forced update. Compares the provided `currentVersion` query parameter against the server's minimum supported version and latest version using semver comparison.
      security: []
      parameters:
        - name: currentVersion
          in: query
          required: false
          schema:
            type: string
            default: 0.0.0
          description: The client's current app version (semver string)
      responses:
        "200":
          description: Version check result
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      forceUpdate:
                        type: boolean
                        description: Whether the client must update to continue
                      latestVersion:
                        type: string
                        description: The latest available app version
                        example: 1.0.0
                      message:
                        type: string
                        description: Present only when forceUpdate is true
                        example: This version is no longer supported. Please update to continue.
  /api/voice/chat:
    post:
      operationId: voiceChat
      tags:
        - Voice
      summary: Full voice conversation with Chef SpAIce
      description: |
        Accepts an audio file, transcribes it, sends the transcript to the AI chef assistant, and returns both the text reply and a spoken audio response (base64 MP3). Supports multi-turn conversations via the conversationHistory field.
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              required:
                - file
              properties:
                file:
                  type: string
                  format: binary
                  description: Audio file (field name "file" or "audio").
                conversationHistory:
                  type: string
                  description: |
                    JSON-encoded array of previous conversation turns. Each element has "role" (user|assistant) and "content".
                  example: '[{"role":"user","content":"Hi"},{"role":"assistant","content":"Hello!"}]'
      responses:
        "200":
          description: Voice chat response with transcript and audio.
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: object
                    properties:
                      userTranscript:
                        type: string
                        description: Transcribed text of the user's audio.
                      aiResponse:
                        type: string
                        description: The AI chef's text reply.
                      audioResponse:
                        type: string
                        format: byte
                        description: Base64-encoded MP3 audio of the AI reply.
                      audioFormat:
                        type: string
                        example: mp3
        "400":
          description: Invalid request.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
              examples:
                notMultipart:
                  value:
                    success: false
                    error: Expected multipart/form-data with audio file
                    errorCode: INVALID_REQUEST_FORMAT
                missingFile:
                  value:
                    success: false
                    error: Please upload an audio file with field name 'file' or 'audio'
                    errorCode: MISSING_AUDIO_FILE
                invalidFormat:
                  value:
                    success: false
                    error: "Supported formats: m4a, mp3, wav, webm, mp4, mpeg, mpga, oga, ogg"
                    errorCode: INVALID_AUDIO_FORMAT
                emptyAudio:
                  value:
                    success: false
                    error: The audio file appears to be empty
                    errorCode: EMPTY_AUDIO
                fileTooLarge:
                  value:
                    success: false
                    error: Maximum file size is 25MB
                    errorCode: FILE_TOO_LARGE
        "500":
          description: AI response or speech generation failed.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
              examples:
                aiResponseFailed:
                  value:
                    success: false
                    error: No response generated from the AI chef
                    errorCode: AI_RESPONSE_FAILED
                speechFailed:
                  value:
                    success: false
                    error: No audio was generated for the AI response
                    errorCode: SPEECH_GENERATION_FAILED
  /api/voice/health:
    get:
      operationId: voiceHealthCheck
      tags:
        - Voice
      summary: Voice service health check
      description: Returns supported audio formats and max file size.
      security:
        - bearerAuth: []
      responses:
        "200":
          description: Health status.
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: object
                    properties:
                      status:
                        type: string
                        example: ok
                      supportedFormats:
                        type: array
                        items:
                          type: string
                        example:
                          - m4a
                          - mp3
                          - wav
                          - webm
                          - mp4
                          - mpeg
                          - mpga
                          - oga
                          - ogg
                      maxFileSize:
                        type: string
                        example: 25MB
  /api/voice/parse:
    post:
      operationId: parseVoiceCommand
      tags:
        - Voice
      summary: Parse a voice command into a structured intent
      description: |
        Takes a transcript string and uses AI to classify the user's intent (e.g., ADD_FOOD, SEARCH_INVENTORY, GENERATE_RECIPE) along with extracted entities and a confidence score.
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - text
              properties:
                text:
                  type: string
                  minLength: 1
                  description: Transcript text to parse.
                  example: add 2 pounds of chicken breast
      responses:
        "200":
          description: Parsed command returned.
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: object
                    properties:
                      intent:
                        type: string
                        enum:
                          - ADD_FOOD
                          - SEARCH_INVENTORY
                          - GENERATE_RECIPE
                          - READ_RECIPE
                          - NEXT_STEP
                          - PREVIOUS_STEP
                          - REPEAT_STEP
                          - WHAT_EXPIRES
                          - HELP
                          - UNKNOWN
                        example: ADD_FOOD
                      entities:
                        type: object
                        additionalProperties:
                          oneOf:
                            - type: string
                            - type: number
                        example:
                          item: chicken breast
                          quantity: 2
                          unit: lbs
                      confidence:
                        type: number
                        format: float
                        minimum: 0
                        maximum: 1
                        example: 0.92
                      rawText:
                        type: string
                        example: add 2 pounds of chicken breast
        "400":
          description: Validation error.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
              example:
                success: false
                error: Transcript text is required
                errorCode: INVALID_INPUT
        "500":
          description: AI parsing failed.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
              example:
                success: false
                error: No response from AI parser
                errorCode: PARSE_FAILED
  /api/voice/speak:
    post:
      operationId: textToSpeech
      tags:
        - Voice
      summary: Convert text to speech
      description: |
        Generates an MP3 audio rendition of the supplied text using OpenAI's audio model. Returns base64-encoded audio data.
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - text
              properties:
                text:
                  type: string
                  minLength: 1
                  maxLength: 4096
                  description: Text to speak.
                  example: Preheat your oven to 375 degrees.
                voice:
                  type: string
                  enum:
                    - alloy
                    - echo
                    - fable
                    - onyx
                    - nova
                    - shimmer
                  default: alloy
                  description: Voice persona to use.
      responses:
        "200":
          description: Speech audio generated.
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: object
                    properties:
                      audio:
                        type: string
                        format: byte
                        description: Base64-encoded MP3 audio.
                      format:
                        type: string
                        example: mp3
        "400":
          description: Validation error.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
              examples:
                emptyText:
                  value:
                    success: false
                    error: Text is required and cannot be empty
                    errorCode: EMPTY_TEXT
                tooLong:
                  value:
                    success: false
                    error: Text must be under 4096 characters
                    errorCode: TEXT_TOO_LONG
        "500":
          description: Speech generation failed.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
              example:
                success: false
                error: No audio was generated from the AI response
                errorCode: SPEECH_GENERATION_FAILED
  /api/voice/transcribe:
    post:
      operationId: transcribeAudio
      tags:
        - Voice
      summary: Transcribe audio to text
      description: |
        Accepts an audio file (via multipart/form-data or base64 JSON) and returns the transcribed text using OpenAI Whisper.
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                file:
                  type: string
                  format: binary
                  description: Audio file (field name "file" or "audio").
                language:
                  type: string
                  default: en
                  description: ISO 639-1 language code.
          application/json:
            schema:
              type: object
              required:
                - audioBase64
                - filename
              properties:
                audioBase64:
                  type: string
                  format: byte
                  description: Base64-encoded audio data.
                filename:
                  type: string
                  description: Original filename with extension (used to determine MIME type).
                  example: recording.m4a
                language:
                  type: string
                  default: en
      responses:
        "200":
          description: Transcription result.
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: object
                    properties:
                      transcript:
                        type: string
                        example: Add two cups of flour
                      language:
                        type: string
                        example: en
        "400":
          description: Invalid request – missing audio, unsupported format, file too large, or empty.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
              examples:
                invalidFormat:
                  value:
                    success: false
                    error: "Supported formats: m4a, mp3, wav, webm, mp4, mpeg, mpga, oga, ogg"
                    errorCode: INVALID_AUDIO_FORMAT
                fileTooLarge:
                  value:
                    success: false
                    error: Maximum file size is 25MB
                    errorCode: FILE_TOO_LARGE
                emptyAudio:
                  value:
                    success: false
                    error: The audio file appears to be empty
                    errorCode: EMPTY_AUDIO
                missingFile:
                  value:
                    success: false
                    error: Please upload an audio file with field name 'file' or 'audio'
                    errorCode: MISSING_AUDIO_FILE
  /api/webhooks/revenuecat:
    post:
      operationId: handleRevenueCatWebhook
      tags:
        - RevenueCat Webhooks
      summary: Handle RevenueCat subscription lifecycle events
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - api_version
                - event
              properties:
                api_version:
                  type: string
                event:
                  type: object
                  required:
                    - type
                    - app_user_id
                    - product_id
                  properties:
                    type:
                      type: string
                      enum:
                        - INITIAL_PURCHASE
                        - RENEWAL
                        - PRODUCT_CHANGE
                        - UNCANCELLATION
                        - CANCELLATION
                        - BILLING_ISSUE
                        - EXPIRATION
                        - TEST
                    app_user_id:
                      type: string
                    original_app_user_id:
                      type: string
                    aliases:
                      type: array
                      items:
                        type: string
                    product_id:
                      type: string
                    period_type:
                      type: string
                    purchased_at_ms:
                      type: integer
                    expiration_at_ms:
                      type: integer
                    environment:
                      type: string
                    entitlement_id:
                      type: string
                    entitlement_ids:
                      type: array
                      items:
                        type: string
                    transaction_id:
                      type: string
                    original_transaction_id:
                      type: string
                    store:
                      type: string
                    price:
                      type: number
                    currency:
                      type: string
                    country_code:
                      type: string
      responses:
        "200":
          description: Event processed
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      received:
                        type: boolean
        "401":
          description: Invalid webhook secret
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorEnvelope"
  /feature-graphic:
    get:
      operationId: getFeatureGraphic
      tags:
        - Health
      summary: Serve Google Play feature-graphic HTML template
      security: []
      responses:
        "200":
          description: HTML page
          content:
            text/html:
              schema:
                type: string
  /marketing:
    get:
      operationId: getMarketingPage
      tags:
        - Health
      summary: Serve marketing landing page HTML
      security: []
      responses:
        "200":
          description: HTML page
          content:
            text/html:
              schema:
                type: string
  /privacy-policy:
    get:
      operationId: getPrivacyPolicy
      tags:
        - Health
      summary: Serve privacy-policy HTML page
      security: []
      responses:
        "200":
          description: HTML page
          content:
            text/html:
              schema:
                type: string
  /support:
    get:
      operationId: getSupportPage
      tags:
        - Health
      summary: Serve support HTML page
      security: []
      responses:
        "200":
          description: HTML page
          content:
            text/html:
              schema:
                type: string
