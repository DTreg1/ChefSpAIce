appId: com.chefspaice.chefspaice
name: Inventory Flow
---

- evalScript: "console.log('LOG: Starting inventory flow')"

- runFlow: auth-flow.yaml

- evalScript: "console.log('LOG: Auth complete, navigating to kitchen tab')"

- tapOn:
    id: "tab-kitchen"

- extendedWaitUntil:
    visible:
      id: "screen-inventory"
    timeout: 10000

- assertVisible:
    id: "screen-inventory"

- evalScript: "console.log('LOG: Inventory screen visible, tapping add button')"

- tapOn:
    id: "add-button"

- tapOn:
    id: "menu-manual"
    optional: true

- tapOn:
    text: "Manual Entry"
    optional: true

- tapOn:
    text: "Add Manually"
    optional: true

- extendedWaitUntil:
    visible:
      id: "input-item-name"
    timeout: 10000

- evalScript: "console.log('LOG: Add item form visible, entering item details')"

- runScript:
    file: helpers/test-account.js

- evalScript: |
    var ts = new Date().getTime();
    output.ITEM_NAME = "Test Apple " + ts;
    console.log('LOG: Generated item name: ' + output.ITEM_NAME);

- tapOn:
    id: "input-item-name"
- waitForAnimationToEnd
- inputText: "${output.ITEM_NAME}"

- hideKeyboard
- tapOn:
    id: "input-item-quantity"
    optional: true
- eraseText
- inputText: "3"

- evalScript: "console.log('LOG: Item name and quantity entered, selecting category')"

- scrollUntilVisible:
    element:
      id: "chip-category-fruits"
    direction: DOWN
    timeout: 5000

- tapOn:
    id: "chip-category-fruits"

- evalScript: "console.log('LOG: Category selected, saving item')"

- hideKeyboard
- tapOn:
    id: "button-save-item"

- extendedWaitUntil:
    visible:
      text: "${output.ITEM_NAME}"
    timeout: 10000

- assertVisible:
    text: "${output.ITEM_NAME}"

- evalScript: "console.log('LOG: Inventory item added successfully, verifying item text visible')"

- assertVisible:
    text: "${output.ITEM_NAME}"
    optional: true

- evalScript: "console.log('LOG: Card inventory item assertion done, testing side panel detail view')"

- tapOn:
    text: "${output.ITEM_NAME}"

- extendedWaitUntil:
    visible:
      id: "panel-item-detail"
    timeout: 5000
    optional: true

- assertVisible:
    id: "panel-item-detail"
    optional: true

- evalScript: "console.log('LOG: Side panel detail view opened')"

- assertVisible:
    id: "button-view-full-details"
    optional: true

- evalScript: "console.log('LOG: View full details button verified in side panel')"

- tapOn:
    id: "button-close-side-panel"
    optional: true

- evalScript: "console.log('LOG: Side panel closed, testing food group filter')"

- tapOn:
    id: "filter-foodgroup-fruits"
    optional: true

- evalScript: "console.log('LOG: Food group filter tapped, verifying filtered results')"

- assertVisible:
    text: "${output.ITEM_NAME}"
    optional: true

- evalScript: "console.log('LOG: Filtered items verified, now deleting item')"

- swipe:
    direction: LEFT
    from:
      text: "${output.ITEM_NAME}"

- tapOn:
    text: "Delete"
    optional: true

- tapOn:
    text: "Remove"
    optional: true

- extendedWaitUntil:
    notVisible:
      text: "${output.ITEM_NAME}"
    timeout: 10000

- evalScript: "console.log('LOG: Item deleted from main list, checking recently deleted section')"

- scrollUntilVisible:
    element:
      id: "button-recently-deleted"
    direction: DOWN
    timeout: 5000
    optional: true

- assertVisible:
    id: "button-recently-deleted"
    optional: true

- evalScript: "console.log('LOG: Recently deleted button found')"

- assertVisible:
    id: "text-recently-deleted-count"
    optional: true

- evalScript: "console.log('LOG: Recently deleted count verified')"

- tapOn:
    id: "button-recently-deleted"
    optional: true

- evalScript: "console.log('LOG: Tapped recently deleted, verifying deleted item appears')"

- assertVisible:
    text: "${output.ITEM_NAME}"
    optional: true

- evalScript: "console.log('LOG: Deleted item found in recently deleted section, inventory flow complete')"
