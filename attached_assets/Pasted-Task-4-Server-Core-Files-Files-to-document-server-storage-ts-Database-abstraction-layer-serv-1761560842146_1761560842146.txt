Task 4: Server Core Files
Files to document:
* server/storage.ts - Database abstraction layer
* server/usda.ts - USDA FoodData Central API integration
* server/replitAuth.ts - Replit authentication setup
* server/batchedApiLogger.ts - API request logging
Documentation Focus:
storage.ts:
/**
* Data Storage Interface
*
* Centralized database abstraction layer using Drizzle ORM.
* Provides type-safe CRUD operations for all application entities.
*
* Key Responsibilities:
* - User management: OIDC claims to user record mapping
* - Inventory operations: Food items, storage locations, categories
* - Recipe management: Creation, favorites, search
* - Meal planning: Meal plans and shopping lists
* - Relationship handling: User-scoped data isolation
*
* Database: PostgreSQL via Drizzle ORM
* Transaction handling: [describe if using transactions]
* Error patterns: [describe error handling approach]
*/

// Document each interface method:
/**
* Retrieve or create user from OIDC claims
*
* Called on every authenticated request to ensure user exists.
* Creates new user record on first login with claims data.
*
* @param claims - OIDC token claims (sub, email, name)
* @returns User record with id, email, name, storageLocations
*
* Behavior:
* - First login: Creates user with default storage locations (Fridge, Freezer, Pantry)
* - Subsequent logins: Returns existing user record
* - Updates: [describe if email/name are updated on subsequent logins]
*/

usda.ts:
/**
* USDA FoodData Central API Integration
*
* Provides nutrition data lookup for food items.
* Uses USDA's free API for standardized nutrition information.
*
* API Endpoints Used:
* - Search: /fdc/v1/foods/search - Find foods by name
* - Details: /fdc/v1/food/{fdcId} - Get full nutrition data
*
* Data Types:
* - Foundation Foods: Lab-analyzed reference foods (most accurate)
* - SR Legacy: Standard Reference legacy data
* - Survey Foods: FNDDS survey foods
* - Branded Foods: Commercial products (less reliable for generic items)
*
* Rate Limits: [specify if known]
* Caching Strategy: [describe if responses are cached]
* Error Handling: [describe how API failures are handled]
*/

/**
* Search USDA database for foods matching query
*
* @param query - Food name to search (e.g., "apple", "chicken breast")
* @param dataType - Filter by food type (default: all types)
* @param pageSize - Results per page (default: 10, max: 50)
* @returns Array of food items with fdcId, description, dataType
*
* Ranking:
* - Results ordered by USDA's relevance score
* - [describe if any custom filtering/sorting is applied]
*/
