[Apple OAuth] Received callback: {
  hasAccessToken: true,
  hasRefreshToken: true,
  idTokenType: 'object',
  idTokenKeys: [ 'id', 'provider', 'email', 'emailVerified' ],
  profileType: 'function',
  profileKeys: []
}
[Apple OAuth] Found user ID: 001420.104f2652d235410789bbef9b7c7a4fa3.0940
[Apple OAuth] Created profile with ID: 001420.104f2652d235410789bbef9b7c7a4fa3.0940
[FACADE:USER] 2025-12-02T03:23:26.664Z - user.createUser failed: {
  errorCode: 'STORAGE_VALIDATION_FAILED',
  errorMessage: 'Last name is required to create a user',
  storageContext: {
    domain: 'user',
    operation: 'createUser',
    entityId: undefined,
    entityType: 'User',
    additionalInfo: { email: 'dtreg1@gmail.com' }
  },
  facadeContext: { facade: 'user', domain: 'user', operation: 'createUser' }
}
[Apple OAuth] Error in verify callback: StorageValidationError: Last name is required to create a user
    at UserAuthDomainStorage.createUser (/home/runner/workspace/server/storage/domains/user.storage.ts:114:13)
    at Proxy.<anonymous> (/home/runner/workspace/server/storage/facades/FacadeErrorBoundary.ts:198:28)
    at StorageRoot.createUser (/home/runner/workspace/server/storage/StorageRoot.ts:136:27)
    at findOrCreateUser (/home/runner/workspace/server/auth/oauth.ts:111:26)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async AppleStrategy._verify (/home/runner/workspace/server/auth/oauth.ts:570:26) {
  code: 'STORAGE_VALIDATION_FAILED',
  context: {
    domain: 'user',
    operation: 'createUser',
    entityId: undefined,
    entityType: 'User',
    additionalInfo: {
      email: 'dtreg1@gmail.com',
      facade: 'user',
      facadeOperation: 'user.createUser'
    }
  },
  originalError: undefined,
  timestamp: 2025-12-02T03:23:26.664Z,
  invalidFields: [ 'lastName' ]
}
Error [500]: Last name is required to create a user
StorageValidationError: Last name is required to create a user
    at UserAuthDomainStorage.createUser (/home/runner/workspace/server/storage/domains/user.storage.ts:114:13)
    at Proxy.<anonymous> (/home/runner/workspace/server/storage/facades/FacadeErrorBoundary.ts:198:28)
    at StorageRoot.createUser (/home/runner/workspace/server/storage/StorageRoot.ts:136:27)
    at findOrCreateUser (/home/runner/workspace/server/auth/oauth.ts:111:26)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async AppleStrategy._verify (/home/runner/workspace/server/auth/oauth.ts:570:26)
[ActivityLogger] Max retry attempts reached. Discarding batch.